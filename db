import React, { useState, useEffect } from "react";
import { createTask, getUsersByTrainerId } from "../../api/trainerApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/trainer-pages.css";


export default function CreateTask() {
  const trainerId = localStorage.getItem("trainerId");
  const trainerName = localStorage.getItem("trainerName");

  const [form, setForm] = useState({
    userId: "",
    trainerId,
    description: "",
    status: "PENDING",
    deadline: "",
    uploadFile: null,
  });

  const [users, setUsers] = useState([]);
  const [msg, setMsg] = useState("");
  const [error, setError] = useState("");

  useEffect(() => {
    if (trainerId) {
      getUsersByTrainerId(trainerId)
        .then((res) => setUsers(res.data))
        .catch((err) =>
          console.error("Failed to load user list for trainer:", err)
        );
    }
  }, [trainerId]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setMsg("");
    setError("");

    if (!form.userId || !form.description) {
      setError("Please fill all required fields!");
      return;
    }

    try {
      await createTask({
        userId: Number(form.userId),
        trainerId: Number(trainerId),
        description: form.description,
        status: form.status,
        deadline: form.deadline,
        uploadFile: form.uploadFile,
      });

      setMsg("Task Assigned Successfully ‚úî");
      setForm({
        ...form,
        userId: "",
        description: "",
        deadline: "",
        status: "PENDING",
        uploadFile: null,
      });
    } catch (err) {
      const backendMsg =
        err.response?.data?.message ||
        err.response?.data ||
        "Failed to create task";
      setError(String(backendMsg));
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>Create Task</h3>

        {msg && <div className="info success">{msg}</div>}
        {error && <div className="info error">{error}</div>}

        <form className="small-form" onSubmit={handleSubmit}>
          <label>Trainer</label>
          <input value={trainerName} disabled />

          <label>Assign To (Intern)</label>
          <select
            value={form.userId}
            onChange={(e) => setForm({ ...form, userId: e.target.value })}
          >
            <option value="">-- Select Intern --</option>
            {users.map((u) => (
              <option key={u.userId} value={u.userId}>
                {u.userName} (Batch {u.batchCode})
              </option>
            ))}
          </select>

          <label>Description</label>
          <textarea
            placeholder="Describe task here..."
            value={form.description}
            onChange={(e) =>
              setForm({ ...form, description: e.target.value })
            }
          ></textarea>

          <label>Deadline</label>
          <input
            type="date"
            value={form.deadline}
            onChange={(e) =>
              setForm({ ...form, deadline: e.target.value })
            }
          />

          <label>Status</label>
          <select
            value={form.status}
            onChange={(e) => setForm({ ...form, status: e.target.value })}
          >
            <option>PENDING</option>
            <option>ONGOING</option>
            <option>COMPLETED</option>
          </select>

          <button className="btn" type="submit">
            Assign Task
          </button>
        </form>
      </div>
    </div>
  );
}


import React, { useEffect, useState } from "react";
import { givePerformance, getUsersByTrainerId } from "../../api/trainerApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/trainer-pages.css";

export default function GivePerformance() {
  const [form, setForm] = useState({
    userId: "",
    trainerId: "",
    trainerName: "",
    batchCode: "",
    remarks: "",
    taskEvaluationScore: "",
  });

  const [users, setUsers] = useState([]);
  const [msg, setMsg] = useState("");
  const [error, setError] = useState("");

  useEffect(() => {
    const trainerId = localStorage.getItem("trainerId");
    const trainerName = localStorage.getItem("trainerName");

    setForm((prev) => ({
      ...prev,
      trainerId,
      trainerName,
    }));

    if (trainerId) {
      getUsersByTrainerId(trainerId)
        .then((res) => setUsers(res.data))
        .catch((err) => console.error("Users fetch failed:", err));
    }
  }, []);

  const handleUserSelect = (e) => {
    const userId = Number(e.target.value);
    const selectedUser = users.find((u) => u.userId === userId);

    setForm((prev) => ({
      ...prev,
      userId,
      batchCode: selectedUser?.batchCode || "",
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setMsg("");
    setError("");

    if (!form.userId || !form.batchCode) {
      setError("Select a user having valid batch assignment");
      return;
    }

    try {
      await givePerformance({
        userId: Number(form.userId),
        trainerId: Number(form.trainerId),
        batchCode: Number(form.batchCode),
        trainerName: form.trainerName,
        remarks: form.remarks,
        taskEvaluationScore: Number(form.taskEvaluationScore),
      });

      setMsg("Performance Saved Successfully ‚úî");
      setForm({
        ...form,
        userId: "",
        batchCode: "",
        remarks: "",
        taskEvaluationScore: "",
      });

    } catch (err) {
      const backendMsg =
        err.response?.data?.message ||
        err.response?.data?.error ||
        err.response?.data ||
        "Failed to save performance";

      setError(String(backendMsg));
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>Give Performance</h3>

        {msg && <div className="info success">{msg}</div>}
        {error && <div className="info error">{error}</div>}

        <form className="small-form" onSubmit={handleSubmit}>
          <label>Trainer</label>
          <input value={form.trainerName} disabled />

          <label>Intern</label>
          <select value={form.userId} onChange={handleUserSelect}>
            <option value="">-- Select Intern --</option>
            {users.map((u) => (
              <option key={u.userId} value={u.userId}>
                {u.userName} (Batch {u.batchCode})
              </option>
            ))}
          </select>

          <label>Batch</label>
          <input value={form.batchCode} disabled />

          <label>Remarks</label>
          <textarea
            value={form.remarks}
            onChange={(e) => setForm({ ...form, remarks: e.target.value })}
          ></textarea>

          <label>Score (0-100)</label>
          <input
            type="number"
            min="0"
            max="100"
            value={form.taskEvaluationScore}
            onChange={(e) => setForm({ ...form, taskEvaluationScore: e.target.value })}
          />

          <button className="btn" type="submit">
            Save
          </button>
        </form>
      </div>
    </div>
  );
}




import React, { useState, useEffect } from "react";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import { getUsersByTrainerId, markAttendance } from "../../api/trainerApi";
import "../../styles/trainer-pages.css";

export default function MarkAttendance() {
  const trainerId = localStorage.getItem("trainerId") || 1;

  const [users, setUsers] = useState([]);
  const [attendanceList, setAttendanceList] = useState([]);
  const [date, setDate] = useState("");
  const [msg, setMsg] = useState("");

  // Load all users in trainer's batches
  useEffect(() => {
    const fetchUsers = async () => {
      try {
        const res = await getUsersByTrainerId(trainerId);
        setUsers(res.data || []);

        // initialize attendance list with default present=true
        const initial = (res.data || []).map((u) => ({
          userId: u.userId,
          batchCode: u.batchCode,
          present: true, // default Present
        }));
        setAttendanceList(initial);
      } catch (e) {
        console.error(e);
        setMsg("Failed to load users");
      }
    };

    fetchUsers();
  }, [trainerId]);

  // Change status Present/Absent for a specific user
  const handleStatusChange = (index, value) => {
    const updated = [...attendanceList];
    updated[index].present = value === "true"; // convert string to boolean
    setAttendanceList(updated);
  };

  // Submit attendance for all users
  const handleSubmit = async (e) => {
    e.preventDefault();
    setMsg("");

    if (!date) {
      setMsg("Please select date first");
      return;
    }

    // ‚úÖ Prevent future date attendance
    const selectedDate = new Date(date);
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    if (selectedDate > today) {
      setMsg("Trainer cannot update attendance for future dates.");
      return;
    }

    try {
      for (const a of attendanceList) {
        await markAttendance({
          userId: a.userId,
          batchCode: a.batchCode,
          date,
          present: a.present,
        });
      }
      setMsg("Attendance saved/updated for all users.");
    } catch (e) {
      console.error(e);
      setMsg(e?.response?.data || e.message || "Error saving attendance");
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>Mark Attendance</h3>

        {msg && <div className="info" style={{ marginBottom: 10 }}>{msg}</div>}

        <form className="small-form" onSubmit={handleSubmit}>
          <label style={{ marginRight: 8 }}>Date:</label>
          <input
            type="date"
            value={date}
            onChange={(e) => setDate(e.target.value)}
          />

          {users.length === 0 ? (
            <div style={{ marginTop: 20 }}>No users found in your batches.</div>
          ) : (
            <table className="table" style={{ marginTop: 20 }}>
              <thead>
                <tr>
                  <th>User ID</th>
                  <th>User Name</th>
                  <th>Batch Code</th>
                  <th>Status (Present / Absent)</th>
                </tr>
              </thead>
              <tbody>
                {users.map((u, index) => (
                  <tr key={u.userId || u.email || index}>
                    <td>{u.userId}</td>
                    <td>{u.userName}</td>
                    <td>{u.batchCode}</td>
                    <td>
                      <select
                        value={attendanceList[index]?.present ? "true" : "false"}
                        onChange={(e) =>
                          handleStatusChange(index, e.target.value)
                        }
                      >
                        <option value="true">Present</option>
                        <option value="false">Absent</option>
                      </select>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          )}

          {users.length > 0 && (
            <button className="btn" type="submit" style={{ marginTop: 10 }}>
              Mark Attendance
            </button>
          )}
        </form>
      </div>
    </div>
  );
}


import React, { useState, useEffect } from "react";
import { getTrainerBatches } from "../../api/trainerApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/trainer-pages.css";
export default function TrainerBatches() {
  const [list, setList] = useState([]);
  const trainerId = localStorage.getItem("trainerId") || 1; // adjust as available

  useEffect(() => {
    const fetch = async () => {
      try {
        const res = await getTrainerBatches(trainerId);
        setList(res.data);
      } catch (e) { console.error(e); }
    };
    fetch();
  }, [trainerId]);

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>My Batches</h3>
        <ul>
          {list.map(b => <li key={b.batchCode}>{b.batchName} - {b.courseName}</li>)}
        </ul>
      </div>
    </div>
  );
}



import React from "react";
import { Link } from "react-router-dom";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/dashboard.css";

export default function TrainerDashboard() {
  const items = [
    { to: "/trainer/batches", label: "My Batches" },
    { to: "/trainer/users", label: "Users in Batch" },
    { to: "/trainer/create-task", label: "Create Task" },
    { to: "/trainer/tasks", label: "View Tasks" },
    { to: "/trainer/attendance", label: "Mark Attendance" },
    { to: "/trainer/performance", label: "Give Performance" },
    { to: "/trainer/feedback", label: "View Feedback" },
  ];

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={items} />

      <div className="main fadeIn">

        {/* Header */}
        <div className="dashboard-header">
          <div className="page-title-block">
            <h2 className="dash-title">Trainer Portal</h2>
            <p className="dash-sub">Manage batches, tasks & attendance easily.</p>
          </div>

          <div className="dash-actions">
            

            <div className="dash-actions-right">
              <div className="theme-toggle">
                <button className="toggle-btn active">‚òÄ</button>
                <button className="toggle-btn">üåô</button>
              </div>
              
              <div className="dash-avatar">
                <img
                  src="https://images.pexels.com/photos/1181371/pexels-photo-1181371.jpeg?auto=compress&cs=tinysrgb&w=800"
                  alt="Trainer"
                />
              </div>
            </div>
          </div>
        </div>

        {/* Banner */}
        <div className="welcome-banner">
          <div className="banner-text">
            <p className="banner-subtitle">Welcome back üëã</p>
            <h3 className="banner-title">Hello Trainer</h3>
            <p className="banner-body">
              Continue empowering interns with impactful guidance.
            </p>
          </div>

          <div className="banner-image">
            <img
              src="https://images.pexels.com/photos/1181352/pexels-photo-1181352.jpeg?auto=compress&cs=tinysrgb&w=800"
              alt="Trainer overview"
            />
          </div>
        </div>

        {/* ALL Quick Access */}
        <div className="section-wrapper">
          <div className="section-header">
            <h3 className="section-title">Quick Access</h3>
            <p className="section-subtitle">
              Jump directly into your actions.
            </p>
          </div>

          <div className="dashboard-info">
            <Link to="/trainer/batches" className="info-card">
              <h3>üì¶ My Batches</h3>
              <p>Assign interns and manage learning schedules.</p>
            </Link>

            <Link to="/trainer/users" className="info-card">
              <h3>üßë‚Äçüéì Users in Batch</h3>
              <p>View and supervise mapped interns.</p>
            </Link>

            <Link to="/trainer/create-task" className="info-card">
              <h3>‚úçÔ∏è Create Task</h3>
              <p>Assign tasks and projects to interns.</p>
            </Link>

            <Link to="/trainer/tasks" className="info-card">
              <h3>üìÇ View Tasks</h3>
              <p>Track submissions and progress.</p>
            </Link>

            <Link to="/trainer/attendance" className="info-card">
              <h3>üìù Mark Attendance</h3>
              <p>Submit and validate daily attendance.</p>
            </Link>

            <Link to="/trainer/performance" className="info-card">
              <h3>‚≠ê Give Performance</h3>
              <p>Evaluate skills and work quality.</p>
            </Link>

            <Link to="/trainer/feedback" className="info-card">
              <h3>üí¨ View Feedback</h3>
              <p>Review intern queries and insights.</p>
            </Link>
          </div>
        </div>
      </div>
    </div>
  );
}


import React, { useState, useEffect } from "react";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import { getFeedbackByTrainerId } from "../../api/trainerApi";
import "../../styles/trainer-pages.css";

export default function TrainerFeedback() {
  const [feedbacks, setFeedbacks] = useState([]);
  const [msg, setMsg] = useState("");

  const trainerId = localStorage.getItem("trainerId");

  const items = [
    { to: "/trainer/dashboard", label: "Dashboard" },
    { to: "/trainer/batches", label: "My Batches" },
    { to: "/trainer/users", label: "Users in Batch" },
    { to: "/trainer/create-task", label: "Create Task" },
    { to: "/trainer/tasks", label: "View Tasks" },
    { to: "/trainer/attendance", label: "Mark Attendance" },
    { to: "/trainer/performance", label: "Give Performance" },
    { to: "/trainer/feedback", label: "View Feedback" },
  ];

  useEffect(() => {
    loadFeedback();
  }, []);

  const loadFeedback = async () => {
    try {
      const res = await getFeedbackByTrainerId(trainerId);
      if (!res.data.length) {
        setMsg("No Feedback Available");
        return;
      }
      setFeedbacks(res.data);
    } catch {
      setMsg("Error loading feedback!");
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={items} />

      <div className="main fadeIn">
        <h2 className="dash-title">‚≠ê Feedback Received</h2>
        {msg && <div className="info">{msg}</div>}

        {feedbacks.length > 0 && (
          <table className="table">
            <thead>
              <tr>
                <th>User</th>
                <th>Batch</th>
                <th>Feedback</th>
                <th>Rating</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              {feedbacks.map((f) => (
                <tr key={f.id}>
                  <td>{f.userName}</td>
                  <td>{f.batchCode}</td>
                  <td>{f.feedback}</td>
                  <td>{f.rating} ‚≠ê</td>
                  <td>{new Date(f.date).toLocaleDateString()}</td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
}




import React, { useEffect, useState } from "react";
import { getTasksByTrainerId, deleteTask } from "../../api/trainerApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import { Link } from "react-router-dom";
import "../../styles/trainer-pages.css";

export default function TrainerViewTasks() {
  const trainerId = localStorage.getItem("trainerId");
  const [tasks, setTasks] = useState([]);
  const [msg, setMsg] = useState("");

  useEffect(() => {
    const fetchTasks = async () => {
      try {
        const res = await getTasksByTrainerId(trainerId);
        setTasks(res.data || []);
      } catch (e) {
        console.error(e);
        setMsg("Failed to load tasks");
      }
    };

    fetchTasks();
  }, [trainerId]);

  const removeTask = async (taskId) => {
    try {
      await deleteTask(taskId);
      setMsg("Task deleted successfully");

      // Reload tasks after deletion
      const res = await getTasksByTrainerId(trainerId);
      setTasks(res.data || []);
    } catch (err) {
      setMsg("Failed to delete task");
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>My Assigned Tasks</h3>
        {msg && <div className="info">{msg}</div>}

        {tasks.length === 0 ? (
          <p>No tasks assigned yet.</p>
        ) : (
          <table className="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Intern ID</th>
                <th>Description</th>
                <th>Status</th>
                <th>Deadline</th>
                <th>Actions</th>
              </tr>
            </thead>

            <tbody>
              {tasks.map((t) => (
                <tr key={t.id}>
                  <td>{t.id}</td>
                  <td>{t.userId}</td>
                  <td>{t.description}</td>
                  <td>{t.status}</td>
                  <td>{t.deadline || "N/A"}</td>

                  <td>
                    <Link className="btn small"
                      to={`/trainer/update-task/${t.id}`}
                    >
                      Edit
                    </Link>

                    <button
                      className="btn small danger"
                      onClick={() => removeTask(t.id)}
                      style={{ marginLeft: 8 }}
                    >
                      Delete
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
}



import React, { useEffect, useState } from "react";
import { updateTask, getTasksByTrainerId } from "../../api/trainerApi";
import { useParams, useNavigate } from "react-router-dom";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/trainer-pages.css";

export default function UpdateTask() {
  const { taskId } = useParams();
  const navigate = useNavigate();
  const trainerId = Number(localStorage.getItem("trainerId"));

  const [form, setForm] = useState({
    userId: null,
    trainerId,
    description: "",
    status: "PENDING",
    deadline: ""
  });

  const [msg, setMsg] = useState("");

  useEffect(() => {
    const loadTask = async () => {
      try {
        const res = await getTasksByTrainerId(trainerId);

        // üî• Correct ID match (convert taskId to number)
        const task = res.data.find((t) => t.id === Number(taskId));

        if (task) {
          setForm({
            userId: task.userId,
            trainerId: task.trainerId,
            description: task.description,
            status: task.status,
            deadline: task.deadline ? task.deadline.split("T")[0] : ""
          });
        }
      } catch (e) {
        console.error(e);
      }
    };
    loadTask();
  }, [taskId, trainerId]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      await updateTask(Number(taskId), {
        userId: form.userId,
        trainerId: form.trainerId,
        description: form.description,
        status: form.status,
        deadline: form.deadline,
        uploadFile: null
      });

      setMsg("‚úî Task updated successfully!");
      setTimeout(() => navigate("/trainer/tasks"), 1000);
    } catch (e) {
      setMsg("Failed to update task ‚ùå");
      console.error(e);
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>Edit Task</h3>

        {msg && <div className="info">{msg}</div>}

        <form className="small-form" onSubmit={handleSubmit}>
          <label>Description</label>
          <textarea
            value={form.description}
            onChange={(e) =>
              setForm({ ...form, description: e.target.value })
            }
          />

          <label>Deadline</label>
          <input
            type="date"
            value={form.deadline}
            onChange={(e) =>
              setForm({ ...form, deadline: e.target.value })
            }
          />

          <label>Status</label>
          <select
            value={form.status}
            onChange={(e) =>
              setForm({ ...form, status: e.target.value })
            }
          >
            <option>PENDING</option>
            <option>ONGOING</option>
            <option>COMPLETED</option>
          </select>

          <button className="btn" type="submit">Update Task</button>
        </form>
      </div>
    </div>
  );
}




import React, { useEffect, useState } from "react";
import { getUsersByTrainerId } from "../../api/trainerApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/trainer-pages.css";

export default function UsersInBatch() {
  const trainerId = localStorage.getItem("trainerId") || 1;
  const [list, setList] = useState([]);
  const [msg, setMsg] = useState("");

  useEffect(() => {
    const fetch = async () => {
      try {
        const res = await getUsersByTrainerId(trainerId);
        setList(res.data);
      } catch (e) {
        console.error(e);
        setMsg("Failed to fetch users");
      }
    };
    fetch();
  }, [trainerId]);

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>Users in My Batches</h3>

        {msg && <div className="info">{msg}</div>}

        {list.length === 0 ? (
          <div>No users found.</div>
        ) : (
          <table className="table">
            <thead>
              <tr>
                <th>User ID</th>
                <th>User Name</th>
                <th>Email</th>
                <th>Contact</th>
                <th>Batch Code</th>
              </tr>
            </thead>
            <tbody>
              {list.map((u) => (
                <tr key={u.email}>
                  <td>{u.userId}</td>
                  <td>{u.userName}</td>
                  <td>{u.email}</td>
                  <td>{u.contactNo}</td>
                  <td>{u.batchCode}</td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
}



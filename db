import api from "./axiosConfig";

// TRAINER
export const createTrainer = (data) => api.post("/api/admin/trainers", data);
export const getTrainers = () => api.get("/api/admin/trainers");
export const deleteTrainerByEmail = (email) =>
  api.delete(`/api/admin/trainer/email/${email}`);

// BATCH
export const createBatch = (data) => api.post("/api/admin/batches", data);
export const getBatches = () => api.get("/api/admin/batches");
export const deleteBatchByName = (batchName) =>
  api.delete(`/api/admin/batch/name/${batchName}`);

// USERS
export const getUsers = () => api.get("/api/admin/users");
export const deleteUserByEmail = (email) =>
  api.delete(`/api/admin/user/email/${email}`);

// STIPEND
export const giveStipend = (data) => api.post("/api/admin/stipend", data);


import React, { createContext, useState, useEffect } from "react";

export const AuthContext = createContext();

export default function AuthProvider({ children }) {
  const [token, setToken] = useState(localStorage.getItem("token"));
  const [role, setRole] = useState(localStorage.getItem("role"));
  const [email, setEmail] = useState(localStorage.getItem("email"));

  useEffect(() => {
    // Sync on mount (in case token stored before)
    const t = localStorage.getItem("token");
    if (t && !token) setToken(t);
    const r = localStorage.getItem("role");
    if (r && !role) setRole(r);
    const e = localStorage.getItem("email");
    if (e && !email) setEmail(e);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  const login = (newToken, newRole, newEmail) => {
    localStorage.setItem("token", newToken);
    localStorage.setItem("role", newRole);
    localStorage.setItem("email", newEmail || "");
    setToken(newToken);
    setRole(newRole);
    setEmail(newEmail || "");
  };

  const logout = () => {
    localStorage.removeItem("token");
    localStorage.removeItem("role");
    localStorage.removeItem("email");
    setToken(null);
    setRole(null);
    setEmail(null);
  };

  return (
    <AuthContext.Provider value={{ token, role, email, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}


import React, { useState, useContext } from "react";
import { loginApi } from "../../api/authApi";
import { AuthContext } from "../../context/AuthContext";
import { useNavigate } from "react-router-dom";
import "../../styles/login.css";

export default function Login() {
  const { login } = useContext(AuthContext);
  const nav = useNavigate();
  const [form, setForm] = useState({ email: "", password: "" });
  const [err, setErr] = useState("");

  const parseJwtPayload = (token) => {
    try {
      const payload = JSON.parse(atob(token.split(".")[1]));
      return {
        role: payload.role,
        email: payload.sub || payload.email || "",
        userId: payload.userId || payload.id,
        trainerId: payload.trainerId,
        trainerName: payload.trainerName,
      };
    } catch (e) {
      return {};
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setErr("");

    try {
      const res = await loginApi(form);
      const token = res.data;

      const { role, email, userId, trainerId, trainerName } =
        parseJwtPayload(token);

      if (!role) throw new Error("Invalid token payload");

      login(token, role, email);

      if (userId) localStorage.setItem("userId", userId);

      if (role === "ROLE_TRAINER") {
        if (trainerId) localStorage.setItem("trainerId", trainerId);
        if (trainerName) localStorage.setItem("trainerName", trainerName);
      }

      if (role === "ROLE_ADMIN") nav("/admin/dashboard");
      else if (role === "ROLE_TRAINER") nav("/trainer/dashboard");
      else nav("/user/dashboard");
    } catch (error) {
      console.error(error);
      setErr(error?.response?.data || error.message || "Login failed");
    }
  };

  return (
    <div className="center">
      <form className="form" onSubmit={handleSubmit}>
        <h2>Login</h2>

        {err && <div className="error">{err}</div>}

        <input
          type="email"
          placeholder="Email"
          value={form.email}
          onChange={(e) => setForm({ ...form, email: e.target.value })}
          required
        />

        <input
          type="password"
          placeholder="Password"
          value={form.password}
          onChange={(e) => setForm({ ...form, password: e.target.value })}
          required
        />

        <button className="btn" type="submit">
          Login
        </button>

        <div className="switch-auth">
          <a href="/user/register">Register as User</a>
        </div>
      </form>
    </div>
  );
}
import React from "react";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";

export default function AdminDashboard() {
  const items = [
    { to: "/admin/create-trainer", label: "Create Trainer" },
    { to: "/admin/view-trainers", label: "View Trainers" },
    { to: "/admin/create-batch", label: "Create Batch" },
    { to: "/admin/view-batches", label: "View Batches" },
    { to: "/admin/give-stipend", label: "Give Stipend" },
    { to: "/admin/view-users", label: "View Users" },
  ];
  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={items} />
      <div className="main">
        <h2>Admin Dashboard</h2>
        <p>Use sidebar to navigate admin features.</p>
      </div>
    </div>
  );
}
import React, { useState } from "react";
import { createBatch } from "../../api/adminApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";

export default function CreateBatch() {
  const [form, setForm] = useState({ batchName: "", courseName: "", trainerId: "", startDate: "", endDate: "", totalSeats: 0, availableSeats: 0 });
  const [msg, setMsg] = useState("");

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      await createBatch({ 
        ...form,
        trainerId: Number(form.trainerId),
        totalSeats: Number(form.totalSeats),
        availableSeats: Number(form.availableSeats)
      });
      setMsg("Batch created");
    } catch (e) { setMsg(e?.response?.data || e.message); }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/admin/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>Create Batch</h3>
        {msg && <div className="info">{msg}</div>}
        <form className="small-form" onSubmit={handleSubmit}>
          <input placeholder="Batch Name" value={form.batchName} onChange={e=>setForm({...form,batchName:e.target.value})}/>
          <input placeholder="Course Name" value={form.courseName} onChange={e=>setForm({...form,courseName:e.target.value})}/>
          <input placeholder="Trainer ID" value={form.trainerId} onChange={e=>setForm({...form,trainerId:e.target.value})}/>
          <input placeholder="Start Date" type="date" value={form.startDate} onChange={e=>setForm({...form,startDate:e.target.value})}/>
          <input placeholder="End Date" type="date" value={form.endDate} onChange={e=>setForm({...form,endDate:e.target.value})}/>
          <input placeholder="Total Seats" value={form.totalSeats} onChange={e=>setForm({...form,totalSeats:e.target.value})}/>
          <input placeholder="Available Seats" value={form.availableSeats} onChange={e=>setForm({...form,availableSeats:e.target.value})}/>
          <button className="btn" type="submit">Create</button>
        </form>
      </div>
    </div>
  );
}
import React, { useState } from "react";
import { createTrainer } from "../../api/adminApi";
import formatError from "../../utils/formatError";

export default function CreateTrainer() {
  const [form, setForm] = useState({
    name: "",
    email: "",
    password: "",
    contact: "",
    experience: "",
    skills: "",
    profilePic: "",
    bio: "",
  });

  const [msg, setMsg] = useState("");

  const handleChange = (e) => {
    setForm({ ...form, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      await createTrainer(form);
      setMsg("Trainer created successfully!");
    } catch (e) {
      setMsg(formatError(e));
    }
  };

  return (
    <div className="container">
      <h2>Create Trainer</h2>
      {msg && <p style={{ color: "red" }}>{msg}</p>}

      <form onSubmit={handleSubmit} className="form">
        <input name="name" placeholder="Name" onChange={handleChange} />
        <input name="email" placeholder="Email" onChange={handleChange} />
        <input name="password" placeholder="Password" onChange={handleChange} />
        <input name="contact" placeholder="Contact" onChange={handleChange} />
        <input name="experience" type="number" placeholder="Experience (years)" onChange={handleChange} />
        <input name="skills" placeholder="Skills" onChange={handleChange} />
        <input name="profilePic" placeholder="Profile Pic URL" onChange={handleChange} />
        <textarea name="bio" placeholder="Bio" onChange={handleChange} />

        <button className="btn">Create</button>
      </form>
    </div>
  );
}
import React, { useState } from "react";
import { giveStipend } from "../../api/adminApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";

export default function GiveStipend() {
  const [form, setForm] = useState({ userId: "", userName: "", paymentMode: "", amount: 0 });
  const [msg, setMsg] = useState("");

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      await giveStipend({ ...form, userId: Number(form.userId), amount: Number(form.amount) });
      setMsg("Stipend recorded");
    } catch (e) { setMsg(e?.response?.data || e.message); }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/admin/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>Give Stipend</h3>
        {msg && <div className="info">{msg}</div>}
        <form className="small-form" onSubmit={handleSubmit}>
          <input placeholder="User ID" value={form.userId} onChange={e=>setForm({...form,userId:e.target.value})}/>
          <input placeholder="User Name" value={form.userName} onChange={e=>setForm({...form,userName:e.target.value})}/>
          <input placeholder="Payment Mode" value={form.paymentMode} onChange={e=>setForm({...form,paymentMode:e.target.value})}/>
          <input placeholder="Amount" value={form.amount} onChange={e=>setForm({...form,amount:e.target.value})}/>
          <button className="btn" type="submit">Give</button>
        </form>
      </div>
    </div>
  );
}
import React, { useEffect, useState } from "react";
import { getTrainers, deleteTrainerByEmail } from "../../api/adminApi";
import formatError from "../../utils/formatError";

export default function ViewTrainers() {
  const [list, setList] = useState([]);
  const [msg, setMsg] = useState("");

  const fetchData = async () => {
    try {
      const res = await getTrainers();
      setList(res.data);
    } catch (e) {
      setMsg(formatError(e));
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  const handleDelete = async (email) => {
    try {
      await deleteTrainerByEmail(email);
      setMsg("Trainer deleted: " + email);
      fetchData();
    } catch (e) {
      setMsg(formatError(e));
    }
  };

  return (
    <div className="container">
      <h2>All Trainers</h2>
      {msg && <p style={{ color: "red" }}>{msg}</p>}

      <table className="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Experience</th>
            <th>Skills</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          {list.map((t) => (
            <tr key={t.trainerId}>
              <td>{t.name}</td>
              <td>{t.email}</td>
              <td>{t.experience}</td>
              <td>{t.skills}</td>
              <td>
                <button onClick={() => handleDelete(t.email)} className="btn">
                  Delete
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
import React, { useEffect, useState } from "react";
import { getTrainers, deleteTrainerByEmail } from "../../api/adminApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";

export default function ViewTrainers() {
  const [list, setList] = useState([]);
  const [msg, setMsg] = useState("");

  const fetch = async () => {
    try {
      const res = await getTrainers();
      setList(res.data);
    } catch (e) { console.error(e); }
  };

  useEffect(() => { fetch(); }, []);

  const handleDelete = async (email) => {
    try {
      await deleteTrainerByEmail(email);
      setMsg("Deleted " + email);
      fetch();
    } catch (e) { setMsg(e?.response?.data || e.message); }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/admin/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>Trainers</h3>
        {msg && <div className="info">{msg}</div>}
        <table className="table">
          <thead><tr><th>Name</th><th>Email</th><th>Contact</th><th>Action</th></tr></thead>
          <tbody>
            {list.map(t => (
              <tr key={t.id || t.email}>
                <td>{t.name}</td>
                <td>{t.email}</td>
                <td>{t.contact}</td>
                <td><button className="btn small" onClick={()=>handleDelete(t.email)}>Delete</button></td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}
import React, { useEffect, useState } from "react";
import { getUsers, deleteUserByEmail } from "../../api/adminApi";
import formatError from "../../utils/formatError";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";

export default function ViewUsers() {
  const [list, setList] = useState([]);
  const [msg, setMsg] = useState("");

  const fetchData = async () => {
    try {
      const res = await getUsers();
      setList(res.data);
    } catch (e) {
      setMsg(formatError(e));
    }
  };

  useEffect(() => {
    fetchData();
  }, []);

  const handleDelete = async (email) => {
    try {
      await deleteUserByEmail(email);
      setMsg("User deleted: " + email);
      fetchData();
    } catch (e) {
      setMsg(formatError(e));
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/admin/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>All Users</h3>
        {msg && <div className="info">{msg}</div>}

        <table className="table">
          <thead>
            <tr>
              <th>User ID</th> {/* ðŸ‘ˆ Added */}
              <th>UserName</th>
              <th>Email</th>
              <th>Contact</th>
              <th>BatchCode</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody>
            {list.map((u) => (
              <tr key={u.userId}>
                <td>{u.userId}</td>  {/* ðŸ‘ˆ Added */}
                <td>{u.userName}</td>
                <td>{u.email}</td>
                <td>{u.contactNo}</td>
                <td>{u.batchCode}</td>
                <td>
                  <button
                    onClick={() => handleDelete(u.email)}
                    className="btn small"
                  >
                    Delete
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>

      </div>
    </div>
  );
}

All Trainers
Name	Email	Experience	Skills	Action
Ram Kumar	ram.trainer@gmail.com	5	Java, Spring Boot, MySQL	Delete
Amit Verma	amit.trainer@gmail.com	8	Python, Django, ML	Delete
prakhar agrawal	prakhar@gmail.com	4	python dev	Delete
iron man	iron@gmail.com	5	tech	Delete
prakhar	prakhar.ag9839@gmail.com	5	java core	Delete
prakhar agrawal 2	prakhar.ag1123@gmail.com	6	python, java	Delete

when in click on view batches then it show the trainer instead of batches 

fix this issue

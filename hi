package com.finalproject.internMgmtSystem.controller;

import com.finalproject.internMgmtSystem.dto.AttendanceDto;
import com.finalproject.internMgmtSystem.dto.PerformanceDto;
import com.finalproject.internMgmtSystem.dto.TaskDto;
import com.finalproject.internMgmtSystem.dto.UserBatchDto;
import com.finalproject.internMgmtSystem.model.*;
import com.finalproject.internMgmtSystem.service.TrainerService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/trainer")
@CrossOrigin
public class TrainerController {

    @Autowired
    private TrainerService trainerService;

    @GetMapping("/batches/{trainerId}")
    public List<InternshipBatch> getBatches(@PathVariable Long trainerId) {
        return trainerService.getBatches(trainerId);
    }

    @PostMapping("/tasks")
    public Task addTask(@Valid @RequestBody TaskDto dto) {
        return trainerService.addTask(dto);
    }

    @GetMapping("/tasks/{trainerId}")
    public List<Task> getTasksByTrainerId(@PathVariable Long trainerId) {
        return trainerService.getTasksByTrainerId(trainerId);
    }

    @PutMapping("/tasks/{taskId}")
    public String updateTask(@Valid @RequestBody TaskDto dto, @PathVariable Long taskId) {
        trainerService.updateTask(dto, taskId);
        return "Task updated successfully";
    }

    @DeleteMapping("/tasks/{taskId}")
    public String deleteTask(@PathVariable Long taskId) {
        trainerService.deleteTask(taskId);
        return "Task deleted successfully";
    }

    @PostMapping("/attendance")
    public Attendance markAttendance(@Valid @RequestBody AttendanceDto dto) {
        return trainerService.markAttendance(dto);
    }

    @PostMapping("/performance")
    public Performance updatePerformance(@Valid @RequestBody PerformanceDto dto) {
        return trainerService.updatePerformance(dto);
    }

    // ‚≠ê FEEDBACK FIXED ‚Äî UNIQUE MAPPINGS
    @GetMapping("/feedback/name/{trainerName}")
    public List<Feedback> getFeedbackByName(@PathVariable String trainerName) {
        return trainerService.viewFeedback(trainerName);
    }

    @GetMapping("/feedback/id/{trainerId}")
    public List<Feedback> getFeedbackByTrainerId(@PathVariable Long trainerId) {
        return trainerService.viewFeedbackByTrainerId(trainerId);
    }

    @GetMapping("/performance/{trainerId}")
    public List<Performance> getPerformanceByTrainerId(@PathVariable Long trainerId) {
        return trainerService.getPerformanceByTrainerId(trainerId);
    }

    @GetMapping("/UserBatch/{trainerId}")
    public List<UserBatchDto> getUsersByTrainerId(@PathVariable int trainerId) {
        return trainerService.getUsersByTrainerId(trainerId);
    }
}

package com.finalproject.internMgmtSystem.service;

import com.finalproject.internMgmtSystem.dto.AttendanceDto;
import com.finalproject.internMgmtSystem.dto.PerformanceDto;
import com.finalproject.internMgmtSystem.dto.TaskDto;
import com.finalproject.internMgmtSystem.dto.UserBatchDto;
import com.finalproject.internMgmtSystem.exception.ResourceNotFoundException;
import com.finalproject.internMgmtSystem.model.*;
import com.finalproject.internMgmtSystem.repository.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.util.List;

@Service
public class TrainerService {

    @Autowired
    private BatchDao batchDao;

    @Autowired
    private TaskDao taskDao;

    @Autowired
    private FeedbackDao feedbackDao;

    @Autowired
    private PerformanceDao performanceDao;

    @Autowired
    private AttendanceDao attendanceDao;
    
    @Autowired
    private UserBatchDao UserBatchDao;

    public List<InternshipBatch> getBatches(Long trainerId) {
        List<InternshipBatch> list = batchDao.findByTrainerId(trainerId);

        if (list.isEmpty()) {
            throw new ResourceNotFoundException("No batches assigned to trainer ID: " + trainerId);
        }

        return list;
    }

    public Task addTask(TaskDto dto) {

        // Optional: validate if user exists / trainer exists

        Task t = new Task();
        t.setUserId(dto.getUserId());
        t.setDescription(dto.getDescription());
        t.setTrainerId(dto.getTrainerId());
        t.setStatus(dto.getStatus());
        t.setDeadline(dto.getDeadline());
        t.setUploadFile(dto.getUploadFile());

        return taskDao.save(t);
    }

    public void updateTask(TaskDto dto, Long taskId) {
        Task t = taskDao.findById(taskId);
        if (t == null) {
            throw new ResourceNotFoundException("Task not found with ID: " + taskId);
        }

        t.setDescription(dto.getDescription());
        t.setStatus(dto.getStatus());
        t.setDeadline(dto.getDeadline());
        t.setUploadFile(dto.getUploadFile());

        taskDao.update(t);
    }

    public void deleteTask(Long id) {
        Task exists = taskDao.findById(id);
        if (exists == null) {
            throw new ResourceNotFoundException("Task not found with ID: " + id);
        }

        taskDao.delete(id);
    }

    public Attendance markAttendance(AttendanceDto dto) {

        if (dto.getDate().toLocalDate().isAfter(LocalDate.now())) {
            throw new RuntimeException("Cannot mark attendance for future dates");
        }

        Attendance a = new Attendance();
        a.setUserId(dto.getUserId());
        a.setBatchCode(dto.getBatchCode());
        a.setDate(dto.getDate());
        a.setPresent(dto.getPresent());

        return attendanceDao.save(a);
    }

    public Performance updatePerformance(PerformanceDto dto) {

        Performance p = new Performance();

        p.setUserId(dto.getUserId());
        p.setTrainerId(dto.getTrainerId());
        p.setBatchCode(dto.getBatchCode());       // NEW
        p.setTrainerName(dto.getTrainerName());   // NEW
        p.setRemarks(dto.getRemarks());
        p.setTaskEvaluationScore(dto.getTaskEvaluationScore());

        return performanceDao.save(p);
    }


    public List<Feedback> viewFeedback(String trainerName) {
        List<Feedback> list = feedbackDao.findByTrainerName(trainerName);

        if (list.isEmpty()) {
            throw new ResourceNotFoundException("No feedback found for trainer: " + trainerName);
        }

        return list;
    }
    
    public List<UserBatchDto> getUsersByTrainerId(int trainerId) {
        return UserBatchDao.getUsersByTrainerId(trainerId);
    }
    public List<Task> getTasksByTrainerId(Long trainerId) {
        List<Task> tasks = taskDao.findByTrainerId(trainerId);
        if (tasks.isEmpty()) {
            throw new ResourceNotFoundException("No tasks found for trainer ID: " + trainerId);
        }
        return tasks;
    }

    public List<Performance> getPerformanceByTrainerId(Long trainerId) {
        List<Performance> list = performanceDao.findByTrainerId(trainerId);
        if (list.isEmpty()) {
            throw new ResourceNotFoundException("No performance records found for trainer ID: " + trainerId);
        }
        return list;
    }
    public List<Feedback> viewFeedbackByTrainerId(Long trainerId) {
        List<Feedback> list = feedbackDao.findByTrainerId(trainerId);
        if (list.isEmpty()) {
            throw new ResourceNotFoundException("No feedback found for trainer ID: " + trainerId);
        }
        return list;
    }



}


package com.finalproject.internMgmtSystem.service;

import com.finalproject.internMgmtSystem.dto.LoginRequest;
import com.finalproject.internMgmtSystem.exception.ResourceNotFoundException;
import com.finalproject.internMgmtSystem.model.Trainer;
import com.finalproject.internMgmtSystem.model.User;
import com.finalproject.internMgmtSystem.repository.TrainerDao;
import com.finalproject.internMgmtSystem.repository.UserDao;
import com.finalproject.internMgmtSystem.security.JwtUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

@Service
public class AuthService {

    @Autowired
    private UserDao userDao;

    @Autowired
    private TrainerDao trainerDao;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Autowired
    private JwtUtil jwtUtil;

    public String login(LoginRequest loginRequest) {

        User user = userDao.findByEmail(loginRequest.getEmail());
        Trainer trainer = trainerDao.findByEmail(loginRequest.getEmail());

        if (user == null && trainer == null) {
            throw new ResourceNotFoundException("Account not found: " + loginRequest.getEmail());
        }

        // USER LOGIN
        if (user != null) {
            if (!passwordEncoder.matches(loginRequest.getPassword(), user.getPassword())) {
                throw new RuntimeException("Invalid password");
            }

            return jwtUtil.generateToken(
                    user.getUserId(),
                    user.getEmail(),
                    "ROLE_" + user.getRole()
            );
        }

        // TRAINER LOGIN
        if (!passwordEncoder.matches(loginRequest.getPassword(), trainer.getPassword())) {
            throw new RuntimeException("Invalid password");
        }

        return jwtUtil.generateTrainerToken(
                trainer.getTrainerId(),
                trainer.getEmail(),
                "ROLE_" + trainer.getRole(),
                trainer.getName()         // Trainer name added inside token
        );
    }
}



package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Performance;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

import java.sql.Timestamp;
import java.util.List;

@Repository
public class PerformanceDaoImpl implements PerformanceDao {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    private RowMapper<Performance> mapper = (rs, rowNum) -> {
        Performance p = new Performance();
        p.setId(rs.getLong("id"));
        p.setUserId(rs.getLong("user_id"));
        p.setTrainerId(rs.getLong("trainer_id"));
        p.setBatchCode(rs.getLong("batch_code"));        // NEW
        p.setTrainerName(rs.getString("trainer_name"));  // NEW
        p.setRemarks(rs.getString("remarks"));
        p.setTaskEvaluationScore(rs.getInt("task_evaluation_score"));
        p.setCreatedAt(rs.getTimestamp("created_at"));
        return p;
    };

    @Override
    public Performance save(Performance p) {
        String sql = """
            INSERT INTO performance 
            (user_id, trainer_id, batch_code, trainer_name, remarks, task_evaluation_score, created_at)
            VALUES (?, ?, ?, ?, ?, ?, NOW())
        """;

        jdbcTemplate.update(sql,
                p.getUserId(),
                p.getTrainerId(),
                p.getBatchCode(),
                p.getTrainerName(),
                p.getRemarks(),
                p.getTaskEvaluationScore()
        );

        Long id = jdbcTemplate.queryForObject("SELECT LAST_INSERT_ID()", Long.class);
        p.setId(id);
        p.setCreatedAt(new Timestamp(System.currentTimeMillis()));
        return p;
    }

    @Override
    public List<Performance> findByUserId(Long userId) {
        return jdbcTemplate.query(
                "SELECT * FROM performance WHERE user_id = ? ORDER BY created_at DESC",
                mapper, userId
        );
    }

    @Override
    public List<Performance> findByTrainerId(Long trainerId) {
        return jdbcTemplate.query(
                "SELECT * FROM performance WHERE trainer_id = ? ORDER BY created_at DESC",
                mapper, trainerId
        );
    }

    @Override
    public void deleteById(Long id) {
        jdbcTemplate.update("DELETE FROM performance WHERE id = ?", id);
    }
}


package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Performance;
import java.util.List;

public interface PerformanceDao {

    Performance save(Performance performance);

    List<Performance> findByUserId(Long userId);

    List<Performance> findByTrainerId(Long trainerId);

    void deleteById(Long id);
    
    
}


package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.InternshipBatch;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public class BatchDaoImpl implements BatchDao {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    // Updated RowMapper to include trainerName
    private RowMapper<InternshipBatch> mapper = (rs, rowNum) -> {
        InternshipBatch b = new InternshipBatch();
        b.setBatchCode(rs.getLong("batch_code"));
        b.setBatchName(rs.getString("batch_name"));
        b.setCourseName(rs.getString("course_name"));
        b.setTrainerId(rs.getLong("trainer_id"));
        b.setTrainerName(rs.getString("trainer_name")); // NEW üëå
        b.setStartDate(rs.getDate("start_date"));
        b.setEndDate(rs.getDate("end_date"));
        b.setTotalSeats(rs.getInt("total_seats"));
        b.setAvailableSeats(rs.getInt("available_seats"));
        return b;
    };

    @Override
    public InternshipBatch save(InternshipBatch batch) {
        String sql = """
                INSERT INTO internship_batches
                (batch_name, course_name, trainer_id, start_date, end_date, total_seats, available_seats)
                VALUES (?, ?, ?, ?, ?, ?, ?)
                """;

        jdbcTemplate.update(sql, batch.getBatchName(), batch.getCourseName(), batch.getTrainerId(),
                batch.getStartDate(), batch.getEndDate(), batch.getTotalSeats(), batch.getAvailableSeats());

        Long id = jdbcTemplate.queryForObject("SELECT LAST_INSERT_ID()", Long.class);
        batch.setBatchCode(id);
        return batch;
    }

    @Override
    public InternshipBatch findById(Long batchCode) {
        return findByBatchCode(batchCode);
    }

    @Override
    public List<InternshipBatch> findAll() {
        String sql = """
                SELECT b.*, t.name AS trainer_name
                FROM internship_batches b
                JOIN trainers t ON b.trainer_id = t.trainer_id
                """;
        return jdbcTemplate.query(sql, mapper);
    }

    @Override
    public List<InternshipBatch> findByTrainerId(Long trainerId) {
        String sql = """
                SELECT b.*, t.name AS trainer_name
                FROM internship_batches b
                JOIN trainers t ON b.trainer_id = t.trainer_id
                WHERE b.trainer_id = ?
                """;
        return jdbcTemplate.query(sql, mapper, trainerId);
    }

    @Override
    public void update(InternshipBatch batch) {
        String sql = """
                UPDATE internship_batches SET batch_name=?, course_name=?, trainer_id=?, start_date=?,
                end_date=?, total_seats=?, available_seats=? WHERE batch_code=?
                """;
        jdbcTemplate.update(sql, batch.getBatchName(), batch.getCourseName(), batch.getTrainerId(),
                batch.getStartDate(), batch.getEndDate(), batch.getTotalSeats(), batch.getAvailableSeats(),
                batch.getBatchCode());
    }

    @Override
    public void delete(Long batchCode) {
        jdbcTemplate.update("DELETE FROM internship_batches WHERE batch_code = ?", batchCode);
    }

    @Override
    public InternshipBatch findByName(String batchName) {
        String sql = """
                SELECT b.*, t.name AS trainer_name
                FROM internship_batches b
                JOIN trainers t ON b.trainer_id = t.trainer_id
                WHERE b.batch_name = ?
                """;
        List<InternshipBatch> list = jdbcTemplate.query(sql, mapper, batchName);
        return list.isEmpty() ? null : list.get(0);
    }

    @Override
    public InternshipBatch findByBatchCode(Long batchCode) {
        String sql = """
                SELECT b.*, t.name AS trainer_name
                FROM internship_batches b
                JOIN trainers t ON b.trainer_id = t.trainer_id
                WHERE b.batch_code = ?
                """;
        List<InternshipBatch> list = jdbcTemplate.query(sql, mapper, batchCode);
        return list.isEmpty() ? null : list.get(0);
    }

    @Override
    public void decrementAvailableSeats(Long batchCode) {
        String sql = """
                UPDATE internship_batches 
                SET available_seats = available_seats - 1 
                WHERE batch_code = ? AND available_seats > 0
                """;
        jdbcTemplate.update(sql, batchCode);
    }
}


package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.InternshipBatch;
import java.util.List;

public interface BatchDao {

    InternshipBatch save(InternshipBatch batch);

    InternshipBatch findById(Long batchCode);

    List<InternshipBatch> findAll();

    List<InternshipBatch> findByTrainerId(Long trainerId);

    void update(InternshipBatch batch);

    void delete(Long batchCode);

    InternshipBatch findByName(String batchName);
    
    InternshipBatch findByBatchCode(Long batchCode);

    void decrementAvailableSeats(Long batchCode);
}


import api from "./axiosConfig";

export const getTrainerBatches = (id) =>
  api.get(`/api/trainer/batches/${id}`);

export const createTask = (data) =>
  api.post("/api/trainer/tasks", data);

export const updateTask = (taskId, data) =>
  api.put(`/api/trainer/tasks/${taskId}`, data);

export const deleteTask = (taskId) =>
  api.delete(`/api/trainer/tasks/${taskId}`);

export const markAttendance = (data) =>
  api.post("/api/trainer/attendance", data);

export const givePerformance = (data) =>
  api.post("/api/trainer/performance", data);

export const getUsersByTrainerId = (trainerId) =>
  api.get(`/api/trainer/UserBatch/${trainerId}`);

export const getTasksByTrainerId = (trainerId) =>
  api.get(`/api/trainer/tasks/${trainerId}`);

// ‚≠ê Correct Feedback API using trainerId
export const getFeedbackByTrainerId = (trainerId) =>
  api.get(`/api/trainer/feedback/id/${trainerId}`);


import React, { createContext, useState, useEffect } from "react";

export const AuthContext = createContext();

export default function AuthProvider({ children }) {
  const [token, setToken] = useState(localStorage.getItem("token"));
  const [role, setRole] = useState(localStorage.getItem("role"));
  const [email, setEmail] = useState(localStorage.getItem("email"));

  useEffect(() => {
    if (localStorage.getItem("token")) setToken(localStorage.getItem("token"));
    if (localStorage.getItem("role")) setRole(localStorage.getItem("role"));
    if (localStorage.getItem("email")) setEmail(localStorage.getItem("email"));
  }, []);

  const login = (newToken, newRole, newEmail) => {
    localStorage.setItem("token", String(newToken || ""));
    localStorage.setItem("role", String(newRole || ""));
    localStorage.setItem("email", String(newEmail || ""));

    setToken(String(newToken || ""));
    setRole(String(newRole || ""));
    setEmail(String(newEmail || ""));
  };

  const logout = () => {
    localStorage.clear();
    setToken(null);
    setRole(null);
    setEmail(null);
  };

  return (
    <AuthContext.Provider value={{ token, role, email, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}


import React, { useState, useContext } from "react";
import { loginApi } from "../../api/authApi";
import { AuthContext } from "../../context/AuthContext";
import { useNavigate } from "react-router-dom";
import "../../styles/login.css";
import AdminIllustration from "../../image/login.png";

export default function Login() {
  const { login } = useContext(AuthContext);
  const nav = useNavigate();
  const [form, setForm] = useState({ email: "", password: "" });
  const [err, setErr] = useState("");

  const parseJwtPayload = (token) => {
    try {
      const payload = JSON.parse(atob(token.split(".")[1]));
      return {
        role:
          typeof payload.role === "string"
            ? payload.role.startsWith("ROLE_")
              ? payload.role
              : `ROLE_${payload.role}`
            : "ROLE_USER",
        sub: payload.sub || "",
        userId: payload.userId,
        trainerId: payload.trainerId,
        trainerName: payload.trainerName,
        batchCode: payload.batchCode,
      };
    } catch {
      return {};
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setErr("");

    try {
      const res = await loginApi(form);
      const token = res.data.token; // ‚úî JSON response

      const { role, sub, userId, trainerId, trainerName, batchCode } =
        parseJwtPayload(token);

      login(token, role, String(sub)); // ‚úî Store token, role, email

      if (role === "ROLE_TRAINER") {
        localStorage.setItem("trainerId", String(trainerId || ""));
        localStorage.setItem("trainerName", String(trainerName || ""));
      }

      if (role === "ROLE_USER") {
        localStorage.setItem("userId", String(userId || ""));
        localStorage.setItem("batchCode", String(batchCode || ""));
      }

      if (role === "ROLE_ADMIN") nav("/admin/dashboard");
      else if (role === "ROLE_TRAINER") nav("/trainer/dashboard");
      else nav("/user/dashboard");
    } catch (error) {
      setErr(
        error?.response?.data?.message ||
          "Invalid credentials! Please enter correct email & password."
      );
    }
  };

  return (
    <div className="login-page">
      <div className="login-card">
        <div className="login-left enhanced-left">
          <div className="login-brand pop-in">
            <div className="brand-icon"><span className="brand-briefcase" /></div>
            <div className="brand-text">
              <div className="brand-title">INTERN-CONNECT</div>
              <div className="brand-subtitle">Portal</div>
            </div>
          </div>

          <div className="login-left-heading slide-up">
            <h1>Welcome Back üëã</h1>
            <p>Manage the entire internship workflow efficiently.</p>
          </div>

          <div className="login-illustration-wrapper float-up">
            <img src={AdminIllustration} alt="Illustration" className="login-illustration" />
          </div>
        </div>

        <div className="login-right">
          <button className="back-home-btn" onClick={() => nav("/")}>
            ‚Üê Home
          </button>

          <div className="login-right-header">
            <h2>Login Here</h2>
            <p>Enter your credentials to access dashboard</p>
          </div>

          {err && <div className="error">{err}</div>}

          <form className="form" onSubmit={handleSubmit}>
            <div className="input-group">
              <span className="input-icon">üë§</span>
              <input
                type="email"
                placeholder="Email"
                value={form.email}
                onChange={(e) =>
                  setForm({ ...form, email: e.target.value })
                }
                required
              />
            </div>

            <div className="input-group">
              <span className="input-icon">üîí</span>
              <input
                type="password"
                placeholder="Password"
                value={form.password}
                onChange={(e) =>
                  setForm({ ...form, password: e.target.value })
                }
                required
              />
            </div>

            <button className="btn" type="submit">
              LOGIN
            </button>

            <div className="switch-auth">
              <a href="/user/register">Register as User</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}


import React, { useEffect, useState } from "react";
import { givePerformance, getUsersByTrainerId } from "../../api/trainerApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/trainer-pages.css";

export default function GivePerformance() {
  const [form, setForm] = useState({
    userId: "",
    trainerId: "",
    trainerName: "",
    batchCode: "",
    remarks: "",
    taskEvaluationScore: "",
  });

  const [users, setUsers] = useState([]);
  const [msg, setMsg] = useState("");
  const [error, setError] = useState("");

  useEffect(() => {
    const trainerId = localStorage.getItem("trainerId");
    const trainerName = localStorage.getItem("trainerName");

    setForm((prev) => ({
      ...prev,
      trainerId,
      trainerName,
    }));

    if (trainerId) {
      getUsersByTrainerId(trainerId)
        .then((res) => setUsers(res.data))
        .catch((err) => console.error("Users fetch failed:", err));
    }
  }, []);

  const handleUserSelect = (e) => {
    const userId = Number(e.target.value);
    const selectedUser = users.find((u) => u.userId === userId);

    setForm((prev) => ({
      ...prev,
      userId,
      batchCode: selectedUser?.batchCode || "",
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setMsg("");
    setError("");

    if (!form.userId || !form.batchCode) {
      setError("‚ö†Ô∏è Select a user having valid batch assignment");
      return;
    }

    try {
      await givePerformance({
        userId: Number(form.userId),
        trainerId: Number(form.trainerId),
        batchCode: Number(form.batchCode),
        trainerName: form.trainerName,
        remarks: form.remarks,
        taskEvaluationScore: Number(form.taskEvaluationScore),
      });

      setMsg("Performance Saved Successfully ‚úî");
      setForm({
        ...form,
        userId: "",
        batchCode: "",
        remarks: "",
        taskEvaluationScore: "",
      });

    } catch (err) {
      const backendMsg =
        err.response?.data?.message ||
        err.response?.data?.error ||
        err.response?.data ||
        "Failed to save performance";

      setError(String(backendMsg));
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>Give Performance</h3>

        {msg && <div className="info success">{msg}</div>}
        {error && <div className="info error">{error}</div>}

        <form className="small-form" onSubmit={handleSubmit}>
          <label>Trainer</label>
          <input value={form.trainerName} disabled />

          <label>Intern</label>
          <select value={form.userId} onChange={handleUserSelect}>
            <option value="">-- Select Intern --</option>
            {users.map((u) => (
              <option key={u.userId} value={u.userId}>
                {u.userName} (Batch {u.batchCode})
              </option>
            ))}
          </select>

          <label>Batch</label>
          <input value={form.batchCode} disabled />

          <label>Remarks</label>
          <textarea
            value={form.remarks}
            onChange={(e) => setForm({ ...form, remarks: e.target.value })}
          ></textarea>

          <label>Score (0-100)</label>
          <input
            type="number"
            min="0"
            max="100"
            value={form.taskEvaluationScore}
            onChange={(e) => setForm({ ...form, taskEvaluationScore: e.target.value })}
          />

          <button className="btn" type="submit">
            Save
          </button>
        </form>
      </div>
    </div>
  );
}

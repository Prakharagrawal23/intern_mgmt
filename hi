package com.finalproject.internMgmtSystem.model;

import java.sql.Timestamp;

public class Performance {

    private Long id;
    private Long userId;
    private Long trainerId;
    private String remarks;
    private Integer taskEvaluationScore;
    private Timestamp createdAt;

    public Performance() {}

    public Performance(Long id, Long userId, Long trainerId, String remarks, Integer taskEvaluationScore, Timestamp createdAt) {
        this.id = id;
        this.userId = userId;
        this.trainerId = trainerId;
        this.remarks = remarks;
        this.taskEvaluationScore = taskEvaluationScore;
        this.createdAt = createdAt;
    }

    // Getters & Setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }

    public Long getUserId() { return userId; }
    public void setUserId(Long userId) { this.userId = userId; }

    public Long getTrainerId() { return trainerId; }
    public void setTrainerId(Long trainerId) { this.trainerId = trainerId; }

    public String getRemarks() { return remarks; }
    public void setRemarks(String remarks) { this.remarks = remarks; }

    public Integer getTaskEvaluationScore() { return taskEvaluationScore; }
    public void setTaskEvaluationScore(Integer taskEvaluationScore) { this.taskEvaluationScore = taskEvaluationScore; }

    public Timestamp getCreatedAt() { return createdAt; }
    public void setCreatedAt(Timestamp createdAt) { this.createdAt = createdAt; }
}
package com.finalproject.internMgmtSystem.dto;

import jakarta.validation.constraints.*;

public class PerformanceDto {

    
	@NotNull(message = "User ID is required")
    private Long userId;

    @NotNull(message = "Trainer ID is required")
    private Long trainerId;

    @NotBlank(message = "Remarks cannot be empty")
    private String remarks;

    @NotNull(message = "Task score is required")
    @Min(value = 0, message = "Score must be >= 0")
    @Max(value = 100, message = "Score must be <= 100")
    private Integer taskEvaluationScore;

    public PerformanceDto() {}
    public PerformanceDto(@NotNull(message = "User ID is required") Long userId,
			@NotNull(message = "Trainer ID is required") Long trainerId,
			@NotBlank(message = "Remarks cannot be empty") String remarks,
			@NotNull(message = "Task score is required") @Min(value = 0, message = "Score must be >= 0") @Max(value = 100, message = "Score must be <= 100") Integer taskEvaluationScore) {
		super();
		this.userId = userId;
		this.trainerId = trainerId;
		this.remarks = remarks;
		this.taskEvaluationScore = taskEvaluationScore;
	}
    // getters + setters
    public Long getUserId() { return userId; }
    public void setUserId(Long userId) { this.userId = userId; }

    public Long getTrainerId() { return trainerId; }
    public void setTrainerId(Long trainerId) { this.trainerId = trainerId; }

    public String getRemarks() { return remarks; }
    public void setRemarks(String remarks) { this.remarks = remarks; }

    public Integer getTaskEvaluationScore() { return taskEvaluationScore; }
    public void setTaskEvaluationScore(Integer taskEvaluationScore) { this.taskEvaluationScore = taskEvaluationScore; }
}


package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Performance;
import java.util.List;

public interface PerformanceDao {

    Performance save(Performance performance);

    List<Performance> findByUserId(Long userId);

    List<Performance> findByTrainerId(Long trainerId);

    void deleteById(Long id);
    
    
}


package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Performance;
import com.finalproject.internMgmtSystem.repository.PerformanceDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public class PerformanceDaoImpl implements PerformanceDao {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    private RowMapper<Performance> mapper = (rs, rowNum) -> {
        Performance p = new Performance();
        p.setId(rs.getLong("id"));
        p.setUserId(rs.getLong("user_id"));
        p.setTrainerId(rs.getLong("trainer_id"));
        p.setRemarks(rs.getString("remarks"));
        p.setTaskEvaluationScore(rs.getInt("task_evaluation_score"));
        p.setCreatedAt(rs.getTimestamp("created_at"));
        return p;
    };

    @Override
    public Performance save(Performance performance) {
        String sql = """
            INSERT INTO performance (user_id, trainer_id, remarks, task_evaluation_score)
            VALUES (?, ?, ?, ?)
        """;

        jdbcTemplate.update(sql,
                performance.getUserId(),
                performance.getTrainerId(),
                performance.getRemarks(),
                performance.getTaskEvaluationScore()
        );

        Long id = jdbcTemplate.queryForObject("SELECT LAST_INSERT_ID()", Long.class);
        performance.setId(id);
        return performance;
    }

    @Override
    public List<Performance> findByUserId(Long userId) {
        return jdbcTemplate.query(
                "SELECT * FROM performance WHERE user_id = ? ORDER BY created_at DESC",
                mapper,
                userId
        );
    }

    @Override
    public List<Performance> findByTrainerId(Long trainerId) {
        return jdbcTemplate.query(
                "SELECT * FROM performance WHERE trainer_id = ? ORDER BY created_at DESC",
                mapper,
                trainerId
        );
    }

    @Override
    public void deleteById(Long id) {
        jdbcTemplate.update("DELETE FROM performance WHERE id = ?", id);
    }
}


package com.finalproject.internMgmtSystem.service;

import com.finalproject.internMgmtSystem.dto.AttendanceDto;
import com.finalproject.internMgmtSystem.dto.PerformanceDto;
import com.finalproject.internMgmtSystem.dto.TaskDto;
import com.finalproject.internMgmtSystem.dto.UserBatchDto;
import com.finalproject.internMgmtSystem.exception.ResourceNotFoundException;
import com.finalproject.internMgmtSystem.model.*;
import com.finalproject.internMgmtSystem.repository.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.util.List;

@Service
public class TrainerService {

    @Autowired
    private BatchDao batchDao;

    @Autowired
    private TaskDao taskDao;

    @Autowired
    private FeedbackDao feedbackDao;

    @Autowired
    private PerformanceDao performanceDao;

    @Autowired
    private AttendanceDao attendanceDao;
    
    @Autowired
    private UserBatchDao UserBatchDao;

    public List<InternshipBatch> getBatches(Long trainerId) {
        List<InternshipBatch> list = batchDao.findByTrainerId(trainerId);

        if (list.isEmpty()) {
            throw new ResourceNotFoundException("No batches assigned to trainer ID: " + trainerId);
        }

        return list;
    }

    public Task addTask(TaskDto dto) {

        // Optional: validate if user exists / trainer exists

        Task t = new Task();
        t.setUserId(dto.getUserId());
        t.setDescription(dto.getDescription());
        t.setTrainerId(dto.getTrainerId());
        t.setStatus(dto.getStatus());
        t.setDeadline(dto.getDeadline());
        t.setUploadFile(dto.getUploadFile());

        return taskDao.save(t);
    }

    public void updateTask(TaskDto dto, Long taskId) {
        Task t = taskDao.findById(taskId);
        if (t == null) {
            throw new ResourceNotFoundException("Task not found with ID: " + taskId);
        }

        t.setDescription(dto.getDescription());
        t.setStatus(dto.getStatus());
        t.setDeadline(dto.getDeadline());
        t.setUploadFile(dto.getUploadFile());

        taskDao.update(t);
    }

    public void deleteTask(Long id) {
        Task exists = taskDao.findById(id);
        if (exists == null) {
            throw new ResourceNotFoundException("Task not found with ID: " + id);
        }

        taskDao.delete(id);
    }

    public Attendance markAttendance(AttendanceDto dto) {

        if (dto.getDate().toLocalDate().isAfter(LocalDate.now())) {
            throw new RuntimeException("Cannot mark attendance for future dates");
        }

        Attendance a = new Attendance();
        a.setUserId(dto.getUserId());
        a.setBatchCode(dto.getBatchCode());
        a.setDate(dto.getDate());
        a.setPresent(dto.getPresent());

        return attendanceDao.save(a);
    }

    public Performance updatePerformance(PerformanceDto dto) {

        Performance p = new Performance();
        p.setUserId(dto.getUserId());
        p.setTrainerId(dto.getTrainerId());
        p.setRemarks(dto.getRemarks());
        p.setTaskEvaluationScore(dto.getTaskEvaluationScore());

        return performanceDao.save(p);
    }

    public List<Feedback> viewFeedback(String trainerName) {
        List<Feedback> list = feedbackDao.findByTrainerName(trainerName);

        if (list.isEmpty()) {
            throw new ResourceNotFoundException("No feedback found for trainer: " + trainerName);
        }

        return list;
    }
    
    public List<UserBatchDto> getUsersByTrainerId(int trainerId) {
        return UserBatchDao.getUsersByTrainerId(trainerId);
    }
    public List<Task> getTasksByTrainerId(Long trainerId) {
        List<Task> tasks = taskDao.findByTrainerId(trainerId);
        if (tasks.isEmpty()) {
            throw new ResourceNotFoundException("No tasks found for trainer ID: " + trainerId);
        }
        return tasks;
    }

    public List<Performance> getPerformanceByTrainerId(Long trainerId) {
        List<Performance> list = performanceDao.findByTrainerId(trainerId);
        if (list.isEmpty()) {
            throw new ResourceNotFoundException("No performance records found for trainer ID: " + trainerId);
        }
        return list;
    }

}
package com.finalproject.internMgmtSystem.controller;

import com.finalproject.internMgmtSystem.dto.AttendanceDto;
import com.finalproject.internMgmtSystem.dto.PerformanceDto;
import com.finalproject.internMgmtSystem.dto.TaskDto;
import com.finalproject.internMgmtSystem.dto.UserBatchDto;
import com.finalproject.internMgmtSystem.model.*;
import com.finalproject.internMgmtSystem.service.TrainerService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/trainer")
@CrossOrigin
public class TrainerController {

    @Autowired
    private TrainerService trainerService;

    // View all batches assigned to trainer
    @GetMapping("/batches/{trainerId}")
    public List<InternshipBatch> getBatches(@PathVariable Long trainerId) {
        return trainerService.getBatches(trainerId);
    }

    // Add Task
    @PostMapping("/tasks")
    public Task addTask(@Valid @RequestBody TaskDto dto) {
        return trainerService.addTask(dto);
    }
    
 // View all tasks assigned by the trainer
    @GetMapping("/tasks/{trainerId}")
    public List<Task> getTasksByTrainerId(@PathVariable Long trainerId) {
        return trainerService.getTasksByTrainerId(trainerId);
    }


    // Update Task
    @PutMapping("/tasks/{taskId}")
    public String updateTask(@Valid @RequestBody TaskDto dto, @PathVariable Long taskId) {
        trainerService.updateTask(dto, taskId);
        return "Task updated successfully";
    }

    // Delete Task
    @DeleteMapping("/tasks/{taskId}")
    public String deleteTask(@PathVariable Long taskId) {
        trainerService.deleteTask(taskId);
        return "Task deleted successfully";
    }

    // Mark Attendance
    @PostMapping("/attendance")
    public Attendance markAttendance(@Valid @RequestBody AttendanceDto dto) {
        return trainerService.markAttendance(dto);
    }

    // Update Performance
    @PostMapping("/performance")
    public Performance updatePerformance(@Valid @RequestBody PerformanceDto dto) {
        return trainerService.updatePerformance(dto);
    }

    // View Feedback
    @GetMapping("/feedback/{trainerName}")
    public List<Feedback> getFeedback(@PathVariable String trainerName) {
        return trainerService.viewFeedback(trainerName);
    }
    
	// View all performance records assigned by the trainer
	@GetMapping("/performance/{trainerId}")
	public List<Performance> getPerformanceByTrainerId(@PathVariable Long trainerId) {
		return trainerService.getPerformanceByTrainerId(trainerId);
	}

  //Fetching the batches and corresponding users
    @GetMapping("/UserBatch/{trainerId}")
    public List<UserBatchDto> getUsersByTrainerId(@PathVariable int trainerId) {
        return trainerService.getUsersByTrainerId(trainerId);
    }
}


import React, { useEffect, useState } from "react";
import { getUserPerformance } from "../../api/userApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";

export default function UserPerformance() {
  const [perf, setPerf] = useState([]);
  const userId = localStorage.getItem("userId") || null;

  useEffect(() => {
    const fetch = async () => {
      try {
        if (!userId) return;
        const res = await getUserPerformance(userId);
        setPerf(res.data);
      } catch (e) {
        console.error(e);
      }
    };
    fetch();
  }, [userId]);

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/user/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>Performance</h3>
        {perf.length === 0 ? <div>No performance records (or userId not supplied).</div> : (
          <ul>
            {perf.map(p => <li key={p.id}>{p.remarks} - Score: {p.taskEvaluationScore}</li>)}
          </ul>
        )}
      </div>
    </div>
  );
}

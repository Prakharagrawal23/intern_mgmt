import api from "./axiosConfig";

export const createTrainer = (data) => api.post("/api/admin/trainers", data);

export const createBatch = (data) => api.post("/api/admin/batches", data);

export const giveStipend = (data) => api.post("/api/admin/stipend", data);

export const getUsers = () => api.get("/api/admin/users");

export const getTrainers = () => api.get("/api/admin/trainers");

export const getBatches = () => api.get("/api/admin/batches");

export const deleteUserByEmail = (email) =>
  api.delete(`/api/admin/user/email/${email}`);

export const deleteTrainerByEmail = (email) =>
  api.delete(`/api/admin/trainer/email/${email}`);

export const deleteBatchByName = (name) =>
  api.delete(`/api/admin/batch/name/${name}`);

export const getAllStipends = () => api.get("/api/admin/stipends");

export const getAllFeedback = () => api.get("/api/admin/feedback");

export const getAdminSummary = () => api.get("/api/admin/summary");


import api from "./axiosConfig";

export const loginApi = (data) => api.post("/api/auth/login", data);
export const createAdminApi = (data) => api.post("/api/auth/create-admin", data);


import axios from "axios";
const api = axios.create({
  baseURL: "http://localhost:9090",
});

api.interceptors.request.use((config) => {
  const t = localStorage.getItem("token");
  if (t) config.headers.Authorization = `Bearer ${t}`;
  return config;
});

export default api;


import api from "./axiosConfig";

export const getTrainerBatches = (trainerId) =>
  api.get(`/api/trainer/batches/${trainerId}`);

export const createTask = (data) =>
  api.post("/api/trainer/tasks", data);

export const updateTask = (taskId, data) =>
  api.put(`/api/trainer/tasks/${taskId}`, data);

export const deleteTask = (taskId) =>
  api.delete(`/api/trainer/tasks/${taskId}`);

export const markAttendance = (data) =>
  api.post("/api/trainer/attendance", data);

export const givePerformance = (data) =>
  api.post("/api/trainer/performance", data);

export const getFeedback = (name) =>
  api.get(`/api/trainer/feedback/${name}`);

export const getUsersByTrainer = (trainerId) =>
  api.get(`/api/trainer/UserBatch/${trainerId}`);

export const getTrainerSummary = (trainerId) =>
  api.get(`/api/trainer/dashboard/${trainerId}`);

import api from "./axiosConfig";

export const registerUser = (data) =>
  api.post("/api/user/register", data);

export const getUserSummary = (userId) =>
  api.get(`/api/user/dashboard/${userId}`);

export const getUserTasks = (userId) =>
  api.get(`/api/user/${userId}/tasks`);

export const getUserPerformance = (userId) =>
  api.get(`/api/user/${userId}/performance`);

export const getUserStipends = (userId) =>
  api.get(`/api/user/${userId}/stipends`);

export const getBatchDetails = (code) =>
  api.get(`/api/user/batch/${code}`);

export const submitFeedback = (data) =>
  api.post("/api/user/feedback", data);
import React, { useContext } from "react";
import { useNavigate } from "react-router-dom";
import { AuthContext } from "../context/AuthContext";

export default function Navbar() {
  const { logout, role, email } = useContext(AuthContext);
  const nav = useNavigate();

  const handleLogout = () => {
    logout();
    nav("/");
  };

  return (
    <div className="nav">
      <div className="nav-left">InternshipMgmt</div>
      <div className="nav-right">
        <span style={{ marginRight: 12 }}>{email}</span>
        <button onClick={handleLogout} className="btn small">Logout</button>
      </div>
    </div>
  );
}


import { Navigate, Outlet } from "react-router-dom";
import { useContext } from "react";
import { AuthContext } from "../context/AuthContext";

export default function ProtectedRoute({ role }) {
  const { token, role: userRole } = useContext(AuthContext);

  if (!token) return <Navigate to="/" replace />;
  if (role !== userRole) return <Navigate to="/" replace />;

  return <Outlet />;
}

import React from "react";
import { Link } from "react-router-dom";

export default function Sidebar({ items = [] }) {
  return (
    <div className="sidebar">
      {items.map((it) => (
        <Link key={it.to} to={it.to} className="sidebar-link">
          {it.label}
        </Link>
      ))}
    </div>
  );
}


import React, { useState, useEffect } from "react";
import "../styles/theme.css";

export default function ThemeToggle() {
  const [darkMode, setDarkMode] = useState(false);

  useEffect(() => {
    if (darkMode) {
      document.body.classList.add("dark-mode");
    } else {
      document.body.classList.remove("dark-mode");
    }
  }, [darkMode]);

  return (
    <div className="theme-toggle" onClick={() => setDarkMode(!darkMode)}>
      {darkMode ? "ðŸŒž" : "ðŸŒ™"}
    </div>
  );
}

import React, { createContext, useState, useEffect } from "react";
export const AuthContext = createContext();

export default function AuthProvider({ children }) {
  const [token, setToken] = useState(localStorage.getItem("token"));
  const [role, setRole] = useState(localStorage.getItem("role"));
  const [email, setEmail] = useState(localStorage.getItem("email"));

  useEffect(() => {
    // Sync on mount (in case token stored before)
    const t = localStorage.getItem("token");
    if (t && !token) setToken(t);
    const r = localStorage.getItem("role");
    if (r && !role) setRole(r);
    const e = localStorage.getItem("email");
    if (e && !email) setEmail(e);
  }, []);

  const login = (newToken, newRole, newEmail) => {
    localStorage.setItem("token", newToken);
    localStorage.setItem("role", newRole);
    localStorage.setItem("email", newEmail || "");
    setToken(newToken);
    setRole(newRole);
    setEmail(newEmail || "");
  };

  const logout = () => {
    localStorage.removeItem("token");
    localStorage.removeItem("role");
    localStorage.removeItem("email");
    setToken(null);
    setRole(null);
    setEmail(null);
  };

  return (
    <AuthContext.Provider value={{ token, role, email, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}


import React, { useState, useContext } from "react";
import { loginApi } from "../../api/authApi";
import { AuthContext } from "../../context/AuthContext";
import { useNavigate } from "react-router-dom";
import "../../styles/login.css";


export default function Login() {
  const { login } = useContext(AuthContext);
  const nav = useNavigate();
  const [form, setForm] = useState({ email: "", password: "" });
  const [err, setErr] = useState("");

  const parseRoleFromJwt = (token) => {
    try {
      const payload = JSON.parse(atob(token.split(".")[1]));
      return { role: payload.role, email: payload.sub || payload?.email || "" };
    } catch (e) {
      return { role: null, email: null };
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setErr("");
    try {
      const res = await loginApi(form);
      const token = res.data;
      const { role, email } = parseRoleFromJwt(token);
      if (!role) throw new Error("Invalid token role");
      login(token, role, email);
      if (role === "ROLE_ADMIN") nav("/admin/dashboard");
      else if (role === "ROLE_TRAINER") nav("/trainer/dashboard");
      else nav("/user/dashboard");
    } catch (error) {
      console.error(error);
      setErr(error?.response?.data || error.message || "Login failed");
    }
  };

  return (
    <div className="center">
      <form className="form" onSubmit={handleSubmit}>
        <h2>Login</h2>
        {err && <div className="error">{err}</div>}
        <input placeholder="Email" value={form.email} onChange={(e) => setForm({ ...form, email: e.target.value })} />
        <input placeholder="Password" type="password" value={form.password} onChange={(e) => setForm({ ...form, password: e.target.value })} />
        <button className="btn" type="submit">Login</button>
        <div style={{ marginTop: 8 }}>
          <a href="/user/register">Register as User</a>
        </div>
      </form>
    </div>
  );
}

export default function formatError(err) {
  if (!err) return "Unknown error";

  // If backend returned response
  if (err.response) {
    const data = err.response.data;

    // Backend returned plain string
    if (typeof data === "string") return data;

    // Backend returned { message: "" }
    if (data?.message) return data.message;

    // Backend returned { error: "" }
    if (data?.error) {
      return typeof data.error === "string"
        ? data.error
        : JSON.stringify(data.error);
    }

    // Fallback parse
    try {
      return JSON.stringify(data);
    } catch {
      return "Server error";
    }
  }

  // If request never reached server
  return err.message || "Network error";
}


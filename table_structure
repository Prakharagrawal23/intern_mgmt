import api from "./axiosConfig";

export const getTrainerBatches = (id) =>
  api.get(`/api/trainer/batches/${id}`);

export const createTask = (data) =>
  api.post("/api/trainer/tasks", data);

export const updateTask = (taskId, data) =>
  api.put(`/api/trainer/tasks/${taskId}`, data);

export const deleteTask = (taskId) =>
  api.delete(`/api/trainer/tasks/${taskId}`);

export const markAttendance = (data) =>
  api.post("/api/trainer/attendance", data);

export const givePerformance = (data) =>
  api.post("/api/trainer/performance", data);

export const getUsersByTrainerId = (trainerId) =>
  api.get(`/api/trainer/UserBatch/${trainerId}`);

export const getTasksByTrainerId = (trainerId) =>
  api.get(`/api/trainer/tasks/${trainerId}`);

// ‚≠ê Correct Feedback API using trainerId
export const getFeedbackByTrainerId = (trainerId) =>
  api.get(`/api/trainer/feedback/id/${trainerId}`);



import React, { createContext, useState, useEffect } from "react";

export const AuthContext = createContext();

export default function AuthProvider({ children }) {
  const [token, setToken] = useState(localStorage.getItem("token"));
  const [role, setRole] = useState(localStorage.getItem("role"));
  const [email, setEmail] = useState(localStorage.getItem("email"));

  useEffect(() => {
    // Sync on mount (in case token stored before)
    const t = localStorage.getItem("token");
    if (t && !token) setToken(t);
    const r = localStorage.getItem("role");
    if (r && !role) setRole(r);
    const e = localStorage.getItem("email");
    if (e && !email) setEmail(e);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  const login = (newToken, newRole, newEmail) => {
    localStorage.setItem("token", newToken);
    localStorage.setItem("role", newRole);
    localStorage.setItem("email", newEmail || "");
    setToken(newToken);
    setRole(newRole);
    setEmail(newEmail || "");
  };

  const logout = () => {
    localStorage.removeItem("token");
    localStorage.removeItem("role");
    localStorage.removeItem("email");
    setToken(null);
    setRole(null);
    setEmail(null);
  };

  return (
    <AuthContext.Provider value={{ token, role, email, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}


import React, { useState, useContext } from "react";
import { loginApi } from "../../api/authApi";
import { AuthContext } from "../../context/AuthContext";
import { useNavigate } from "react-router-dom";
import "../../styles/login.css";
import AdminIllustration from "../../image/login.png";

export default function Login() {
  const { login } = useContext(AuthContext);
  const nav = useNavigate();
  const [form, setForm] = useState({ email: "", password: "" });
  const [err, setErr] = useState("");

  const parseJwtPayload = (token) => {
    try {
      const payload = JSON.parse(atob(token.split(".")[1]));
      return {
        role: payload.role,
        email: payload.sub || payload.email || "",
        userId: payload.userId || payload.id,
        trainerId: payload.trainerId,
        trainerName: payload.trainerName,
      };
    } catch {
      return {};
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setErr("");

    try {
      const res = await loginApi(form);
      const token = res.data;
      const { role, email, userId, trainerId, trainerName } =
        parseJwtPayload(token);

      if (!role) throw new Error("Invalid token payload");

      login(token, role, email);

      if (userId) localStorage.setItem("userId", userId);
      if (role === "ROLE_TRAINER") {
        if (trainerId) localStorage.setItem("trainerId", trainerId);
        if (trainerName) localStorage.setItem("trainerName", trainerName);
      }

      if (role === "ROLE_ADMIN") nav("/admin/dashboard");
      else if (role === "ROLE_TRAINER") nav("/trainer/dashboard");
      else nav("/user/dashboard");
    } catch (error) {
      setErr(error?.response?.data || error.message || "Login failed");
    }
  };

  return (
    <div className="login-page">
      <div className="login-card">

        {/* LEFT SIDE */}
        <div className="login-left enhanced-left">
          <div className="login-brand pop-in">
            <div className="brand-icon">
              <span className="brand-briefcase" />
            </div>
            <div className="brand-text">
              <div className="brand-title">INTERN-CONNECT</div>
              <div className="brand-subtitle">Portal</div>
            </div>
          </div>

          <div className="login-left-heading slide-up">
            <h1>Welcome Back üëã</h1>
            <p>Manage the entire internship workflow efficiently.</p>
          </div>

          <div className="login-illustration-wrapper float-up">
            <img src={AdminIllustration} alt="Admin working" className="login-illustration" />
          </div>
        </div>

        {/* RIGHT SIDE */}
        <div className="login-right">
          <button className="back-home-btn" onClick={() => nav("/")}>
            <span className="arrow-icon">‚Üê</span>
            Home
          </button>

          <div className="login-right-header">
            <h2>Login Here</h2>
            <p>Enter your credentials to access dashboard</p>
          </div>

          {err && <div className="error">{err}</div>}

          <form className="form" onSubmit={handleSubmit}>
            <div className="input-group">
              <span className="input-icon">üë§</span>
              <input type="email" placeholder="Email"
                value={form.email}
                onChange={(e) => setForm({ ...form, email: e.target.value })}
                required />
            </div>

            <div className="input-group">
              <span className="input-icon">üîí</span>
              <input type="password" placeholder="Password"
                value={form.password}
                onChange={(e) => setForm({ ...form, password: e.target.value })}
                required />
            </div>

            <button className="btn" type="submit">LOGIN</button>

            <div className="switch-auth">
              <a href="/user/register">Register as User</a>
            </div>
          </form>
        </div>

      </div>
    </div>
  );
}



import React from "react";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/dashboard.css";

export default function TrainerDashboard() {
  const items = [
    { to: "/trainer/batches", label: "My Batches" },
    { to: "/trainer/users", label: "Users in Batch" },
    { to: "/trainer/create-task", label: "Create Task" },
    { to: "/trainer/tasks", label: "View Tasks" },
    { to: "/trainer/attendance", label: "Mark Attendance" },
    { to: "/trainer/performance", label: "Give Performance" },
    { to: "/trainer/feedback", label: "View Feedback" } // ‚≠ê ADDED
  ];

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={items} />
      <div className="main fadeIn">
        <h2 className="dash-title">Trainer Portal</h2>
        <p className="dash-sub">
          Manage batches, tasks & attendance easily.
        </p>

        <div className="dashboard-info">
          <div className="info-card">
            <h3>üìå Assign Tasks</h3>
            <p>Create assignments and track submissions.</p>
          </div>

          <div className="info-card">
            <h3>üìù Attendance</h3>
            <p>Mark and review attendance daily.</p>
          </div>

          <div className="info-card">
            <h3>‚≠ê Performance</h3>
            <p>Evaluate student progress and growth.</p>
          </div>
        </div>
      </div>
    </div>
  );
}



import React, { useState, useEffect } from "react";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import { getFeedbackByTrainerId } from "../../api/trainerApi";
import "../../styles/dashboard.css";

export default function TrainerFeedback() {
  const [feedbacks, setFeedbacks] = useState([]);
  const [msg, setMsg] = useState("");

  const trainerId = localStorage.getItem("trainerId");

  const items = [
    { to: "/trainer/dashboard", label: "Dashboard" },
    { to: "/trainer/batches", label: "My Batches" },
    { to: "/trainer/users", label: "Users in Batch" },
    { to: "/trainer/create-task", label: "Create Task" },
    { to: "/trainer/tasks", label: "View Tasks" },
    { to: "/trainer/attendance", label: "Mark Attendance" },
    { to: "/trainer/performance", label: "Give Performance" },
    { to: "/trainer/feedback", label: "View Feedback" },
  ];

  useEffect(() => {
    loadFeedback();
    // eslint-disable-next-line
  }, []);

  const loadFeedback = async () => {
    try {
      const res = await getFeedbackByTrainerId(trainerId);
      if (!res.data.length) {
        setMsg("No Feedback Available");
        return;
      }
      setFeedbacks(res.data);
    } catch {
      setMsg("Error loading feedback!");
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={items} />

      <div className="main fadeIn">
        <h2 className="dash-title">‚≠ê Feedback Received</h2>
        {msg && <div className="info">{msg}</div>}

        {feedbacks.length > 0 && (
          <table className="table">
            <thead>
              <tr>
                <th>User</th>
                <th>Batch</th>
                <th>Feedback</th>
                <th>Rating</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              {feedbacks.map((f) => (
                <tr key={f.id}>
                  <td>{f.userName}</td>
                  <td>{f.batchCode}</td>
                  <td>{f.feedback}</td>
                  <td>{f.rating} ‚≠ê</td>
                  <td>{new Date(f.date).toLocaleDateString()}</td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
}

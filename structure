package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Attendance;
import java.sql.Date;
import java.util.List;

public interface AttendanceDao {

    Attendance save(Attendance attendance);

    Attendance findByUserIdAndDate(Long userId, Date date);

    List<Attendance> findByUserId(Long userId);

    List<Attendance> findByBatchCode(Long batchCode);

    void update(Attendance attendance);

    void delete(Long attendanceId);
}

package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Attendance;
import com.finalproject.internMgmtSystem.repository.AttendanceDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

import java.sql.Date;
import java.util.List;

@Repository
public class AttendanceDaoImpl implements AttendanceDao {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    private RowMapper<Attendance> mapper = (rs, rowNum) -> {
        Attendance a = new Attendance();
        a.setAttendanceId(rs.getLong("attendance_id"));
        a.setUserId(rs.getLong("user_id"));
        a.setBatchCode(rs.getLong("batch_code"));
        a.setDate(rs.getDate("date"));
        a.setPresent(rs.getBoolean("present"));
        return a;
    };

    @Override
    public Attendance save(Attendance attendance) {
        String sql = """
            INSERT INTO attendance (user_id, batch_code, date, present)
            VALUES (?, ?, ?, ?)
        """;

        jdbcTemplate.update(sql,
                attendance.getUserId(),
                attendance.getBatchCode(),
                attendance.getDate(),
                attendance.getPresent()
        );

        Long id = jdbcTemplate.queryForObject("SELECT LAST_INSERT_ID()", Long.class);
        attendance.setAttendanceId(id);
        return attendance;
    }

    @Override
    public Attendance findByUserIdAndDate(Long userId, Date date) {
        List<Attendance> list = jdbcTemplate.query(
                "SELECT * FROM attendance WHERE user_id = ? AND date = ?",
                mapper,
                userId,
                date
        );
        return list.isEmpty() ? null : list.get(0);
    }

    @Override
    public List<Attendance> findByUserId(Long userId) {
        return jdbcTemplate.query(
                "SELECT * FROM attendance WHERE user_id = ? ORDER BY date DESC",
                mapper,
                userId
        );
    }

    @Override
    public List<Attendance> findByBatchCode(Long batchCode) {
        return jdbcTemplate.query(
                "SELECT * FROM attendance WHERE batch_code = ? ORDER BY date DESC",
                mapper,
                batchCode
        );
    }

    @Override
    public void update(Attendance attendance) {
        String sql = """
            UPDATE attendance SET present = ? WHERE attendance_id = ?
        """;
        jdbcTemplate.update(sql, attendance.getPresent(), attendance.getAttendanceId());
    }

    @Override
    public void delete(Long attendanceId) {
        jdbcTemplate.update("DELETE FROM attendance WHERE attendance_id = ?", attendanceId);
    }
}


package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.InternshipBatch;
import java.util.List;

public interface BatchDao {

    InternshipBatch save(InternshipBatch batch);

    InternshipBatch findById(Long batchCode);

    List<InternshipBatch> findAll();

    List<InternshipBatch> findByTrainerId(Long trainerId);

    void update(InternshipBatch batch);

    void delete(Long batchCode);

    InternshipBatch findByName(String batchName);
    
    InternshipBatch findByBatchCode(Long batchCode);

    void decrementAvailableSeats(Long batchCode);
}


package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Feedback;
import java.util.List;

public interface FeedbackDao {

    Feedback save(Feedback feedback);

    List<Feedback> findByTrainerName(String trainerName);

    List<Feedback> findByUserId(Long userId);

    List<Feedback> findAll();
}


package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Performance;
import java.util.List;

public interface PerformanceDao {

    Performance save(Performance performance);

    List<Performance> findByUserId(Long userId);

    List<Performance> findByTrainerId(Long trainerId);

    void deleteById(Long id);
}


package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Stipend;
import java.util.List;

public interface StipendDao {

    Stipend save(Stipend stipend);

    List<Stipend> findByUserId(Long userId);

    List<Stipend> findAll();
}



package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Task;
import java.util.List;

public interface TaskDao {

    Task save(Task task);

    Task findById(Long id);

    List<Task> findByUserId(Long userId);

    List<Task> findByTrainerId(Long trainerId);

    void update(Task task);

    void delete(Long id);
}





package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Trainer;
import java.util.List;

public interface TrainerDao {

    Trainer save(Trainer trainer);

    Trainer findByEmail(String email);

    Trainer findById(Long id);

    List<Trainer> findAll();

    void update(Trainer trainer);

    void deleteById(Long id);

    void deleteByEmail(String email);
}





package com.finalproject.internMgmtSystem.repository;

import java.util.List;
import com.finalproject.internMgmtSystem.dto.UserBatchDto;

public interface UserBatchDao {
    List<UserBatchDto> getUsersByTrainerId(int trainerId);
}




package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.User;
import java.util.List;

public interface UserDao {

    User save(User user);

    User findByEmail(String email);

    User findById(Long id);

    List<User> findAll();

    void update(User user);

    void deleteById(Long id);
}

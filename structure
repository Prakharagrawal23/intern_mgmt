select * from users;
+---------+-------------------+---------------------------+--------------------------------------------------------------+------------+------------+---------------+----------------+-------+-------+--------------+------------+------------+-----------------+------------------+-------------+-------+---------------------+------------+
| user_id | user_name         | email                     | password                                                     | dob        | contact_no | address       | college_name   | grade | major | team         | start_date | end_date   | graduating_year | resume           | profile_pic | role  | created_at          | batch_code |
+---------+-------------------+---------------------------+--------------------------------------------------------------+------------+------------+---------------+----------------+-------+-------+--------------+------------+------------+-----------------+------------------+-------------+-------+---------------------+------------+
|       1 | Prakhar           | demo@gmail.com            | $2a$10$i8bE0abnfp87a59nLYT6EekKAU58eVne1.2av/kcxhxE3/lX81DSu | 2003-05-21 | 9876543210 | Uttar Pradesh | GLA University | A     | CSE   | Java         | 2025-02-01 | 2025-04-01 |            2025 | resume.pdf       | profile.jpg | USER  | 2025-11-20 21:16:52 |          1 |
|       2 | Prakhar Agrawal   | prakhar@gmail.com         | $2a$10$JDEuSRh4AcG0l2U1BjQVgO4h1.xZ9vq5P1XRg8Mm1Nn.4y2mauCGe | 2003-05-21 | 9876543210 | Uttar Pradesh | GLA University | A     | CSE   | Java         | 2025-02-01 | 2025-04-01 |            2025 | resume.pdf       | prakhar.jpg | USER  | 2025-11-20 21:27:09 |          2 |
|       3 | Rohan Singh       | rohan@gmail.com           | $2a$10$JDEuSRh4AcG0l2U1BjQVgO4h1.xZ9vq5P1XRg8Mm1Nn.4y2mauCGe | 2002-10-10 | 9012345678 | Delhi         | IIT Delhi      | A+    | ECE   | Python       | 2025-02-01 | 2025-04-01 |            2025 | rohan_resume.pdf | rohan.png   | USER  | 2025-11-20 21:27:09 |          3 |
|      13 | Rohit Sharma2     | rohit1.user1232@gmail.com | $2a$10$7Ry1lLbFWIe5kY9pHWlr.untZNbztFunh7al0reIlqbSyM/s66kdO | 2002-01-15 | 9876543210 | Delhi         | IIT Delhi      | A     | CSE   | Java         | 2025-01-10 | 2025-04-10 |            2025 | resume.pdf       | rohit.png   | USER  | 2025-11-24 23:33:52 |          4 |
|      14 | mayank agrawal    | mayank.ag1963@gmail.com   | $2a$10$8vmM59h3VBVDSs5mqIxrL.LCDKedilPIcQdXYSfOrQKJH5EpoqJ1. | 2002-01-15 | 9876543210 | Delhi         | IIT Delhi      | A     | CSE   | Java         | 2025-01-10 | 2025-04-10 |            2025 | resume.pdf       | rohit.png   | USER  | 2025-11-26 20:40:53 |          5 |
|      15 | System Admin      | admin@gmail.com           | $2a$10$yOWXy88q5UPYzsQVYaKwPOhMPw/F.Yr9x.fSNpJ.jeJdCYA1FXn7a | NULL       | NULL       | NULL          | NULL           | NULL  | NULL  | NULL         | NULL       | NULL       |            NULL | NULL             | NULL        | ADMIN | 2025-11-26 23:29:50 |       NULL |
|      18 | prakhar agrawal 3 | returnbydeath16@gmail.com | $2a$10$xQQ.q5.4ig1tjtByQc8AQelm3O6trOc7dIYT.nOOoIeNp2pxBvLJC | 2025-12-01 | 8887876113 | newyork       | gla university | 7.52  | CSE   | Java python  | 2025-12-02 | 2025-12-31 |            2026 | resume.pdf       | prakhar.png | USER  | 2025-12-01 23:57:35 |          1 |
|      19 | prakhar agrawal 3 | prakhar123@gmail.com      | $2a$10$fM8Gk90IbLPuujkNk94X5.s.0O2L8gCrbUAZzOlN8ZQLiOXLK6Qhm | 2025-12-01 | 8887876113 | newyork       | gla university | 7.52  | CSE   | Java python  | 2025-12-02 | 2025-12-31 |            2026 | resume.pdf       | prakhar.png | USER  | 2025-12-02 16:33:03 |          7 |
|      21 | admin@gmail.com   | rajul@gmail.com           | $2a$10$uEIs9AWnd.4qZq5PoKFQ/uAyluPzo3yuexCFxiywEajTFOLJW26qi | 2025-12-16 | 8887876113 | newyork       | gla university | 7.52  | CSE   | Java python  | 2025-12-02 | 2025-12-31 |            2026 | resume.pdf       | prakhar.png | USER  | 2025-12-05 15:51:11 |          7 |
|      22 | rajat agrawal     | rajat@gmail.com           | $2a$10$buSa.JjGiHKFU6Acx13AA.hY9.h6tIH2ik3N./qdgk4uAgCIKFFnK | 2001-10-23 | 8887876113 | newyork       | gla university | 7.52  | CSE   | Java python  | 2025-12-05 | 2025-12-31 |            2026 | resume.pdf       | prakhar.png | USER  | 2025-12-05 16:33:27 |          9 |
+---------+-------------------+---------------------------+--------------------------------------------------------------+------------+------------+---------------+----------------+-------+-------+--------------+------------+------------+-----------------+------------------+-------------+-------+---------------------+------------+
10 rows in set (0.00 sec)

mysql> describe users;
+-----------------+--------------+------+-----+-------------------+-------------------+
| Field           | Type         | Null | Key | Default           | Extra             |
+-----------------+--------------+------+-----+-------------------+-------------------+
| user_id         | bigint       | NO   | PRI | NULL              | auto_increment    |
| user_name       | varchar(255) | NO   |     | NULL              |                   |
| email           | varchar(255) | NO   | UNI | NULL              |                   |
| password        | varchar(255) | NO   |     | NULL              |                   |
| dob             | date         | YES  |     | NULL              |                   |
| contact_no      | varchar(20)  | YES  |     | NULL              |                   |
| address         | varchar(255) | YES  |     | NULL              |                   |
| college_name    | varchar(255) | YES  |     | NULL              |                   |
| grade           | varchar(50)  | YES  |     | NULL              |                   |
| major           | varchar(255) | YES  |     | NULL              |                   |
| team            | varchar(255) | YES  |     | NULL              |                   |
| start_date      | date         | YES  |     | NULL              |                   |
| end_date        | date         | YES  |     | NULL              |                   |
| graduating_year | int          | YES  |     | NULL              |                   |
| resume          | varchar(255) | YES  |     | NULL              |                   |
| profile_pic     | varchar(255) | YES  |     | NULL              |                   |
| role            | varchar(50)  | NO   |     | USER              |                   |
| created_at      | timestamp    | YES  |     | CURRENT_TIMESTAMP | DEFAULT_GENERATED |
| batch_code      | bigint       | YES  | MUL | NULL              |                   |
+-----------------+--------------+------+-----+-------------------+-------------------+
19 rows in set (0.02 sec)

mysql>

package com.finalproject.internMgmtSystem.model;

import java.sql.Date;
import java.sql.Timestamp;

public class User {

    
	private Long userId;
    private String userName;
    private String email;
    private String password;
    private Date dob;
    private String contactNo;
    private String address;
    private String collegeName;
    private String grade;
    private String major;
    private String team;
    private Long batchCode;
    private Date startDate;
    private Date endDate;
    private Integer graduatingYear;
    private String resume;
    private String profilePic;
    private String role;
    private Timestamp createdAt;
    


    public User() {}
    public User(Long userId, String userName, String email, String password, Date dob, String contactNo, String address,
			String collegeName, String grade, String major, String team, Long batchCode, Date startDate, Date endDate,
			Integer graduatingYear, String resume, String profilePic, String role, Timestamp createdAt) {
		super();
		this.userId = userId;
		this.userName = userName;
		this.email = email;
		this.password = password;
		this.dob = dob;
		this.contactNo = contactNo;
		this.address = address;
		this.collegeName = collegeName;
		this.grade = grade;
		this.major = major;
		this.team = team;
		this.batchCode = batchCode;
		this.startDate = startDate;
		this.endDate = endDate;
		this.graduatingYear = graduatingYear;
		this.resume = resume;
		this.profilePic = profilePic;
		this.role = role;
		this.createdAt = createdAt;
	}
   

    // Getters & Setters
    public Long getUserId() { return userId; }
    public void setUserId(Long userId) { this.userId = userId; }

    public String getUserName() { return userName; }
    public void setUserName(String userName) { this.userName = userName; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }

    public Date getDob() { return dob; }
    public void setDob(Date dob) { this.dob = dob; }

    public String getContactNo() { return contactNo; }
    public void setContactNo(String contactNo) { this.contactNo = contactNo; }

    public String getAddress() { return address; }
    public void setAddress(String address) { this.address = address; }

    public String getCollegeName() { return collegeName; }
    public void setCollegeName(String collegeName) { this.collegeName = collegeName; }

    public String getGrade() { return grade; }
    public void setGrade(String grade) { this.grade = grade; }

    public String getMajor() { return major; }
    public void setMajor(String major) { this.major = major; }

    public String getTeam() { return team; }
    public void setTeam(String team) { this.team = team; }

    public Date getStartDate() { return startDate; }
    public void setStartDate(Date startDate) { this.startDate = startDate; }

    public Date getEndDate() { return endDate; }
    public void setEndDate(Date endDate) { this.endDate = endDate; }

    public Integer getGraduatingYear() { return graduatingYear; }
    public void setGraduatingYear(Integer graduatingYear) { this.graduatingYear = graduatingYear; }

    public String getResume() { return resume; }
    public void setResume(String resume) { this.resume = resume; }

    public String getProfilePic() { return profilePic; }
    public void setProfilePic(String profilePic) { this.profilePic = profilePic; }

    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }

    public Timestamp getCreatedAt() { return createdAt; }
    public void setCreatedAt(Timestamp createdAt) { this.createdAt = createdAt; }
	public Long getBatchCode() {
		return batchCode;
	}
	public void setBatchCode(Long batchCode) {
		this.batchCode = batchCode;
	}
}



package com.finalproject.internMgmtSystem.dto;

import jakarta.validation.constraints.*;
import java.sql.Date;

public class RegisterUserDto {

    
	@NotBlank(message = "User name is required")
    private String userName;

    @NotBlank(message = "Email is required")
    @Email(message = "Enter a valid email")
    private String email;

    @NotBlank(message = "Password is required")
    private String password;

    @NotNull(message = "Date of birth is required")
    private Date dob;

    @NotBlank(message = "Contact number is required")
    private String contactNo;

    @NotBlank(message = "Address is required")
    private String address;

    @NotBlank(message = "College name is required")
    private String collegeName;

    @NotBlank(message = "Grade is required")
    private String grade;

    @NotBlank(message = "Major is required")
    private String major;

    @NotBlank(message = "Team selection is required")
    private String team;
    
    @NotNull(message = "batch Code is required")
    private Long batchCode;
    		
    @NotNull(message = "Start date is required")
    private Date startDate;

    @NotNull(message = "End date is required")
    private Date endDate;

    @NotNull(message = "Graduating year is required")
    @Min(value = 2020, message = "Graduating year must be >= 2020")
    private Integer graduatingYear;

    @NotBlank(message = "Resume URL/path is required")
    private String resume;

    private String profilePic;

    public RegisterUserDto() {}
    
    
    public RegisterUserDto(@NotBlank(message = "User name is required") String userName,
			@NotBlank(message = "Email is required") @Email(message = "Enter a valid email") String email,
			@NotBlank(message = "Password is required") String password,
			@NotNull(message = "Date of birth is required") Date dob,
			@NotBlank(message = "Contact number is required") String contactNo,
			@NotBlank(message = "Address is required") String address,
			@NotBlank(message = "College name is required") String collegeName,
			@NotBlank(message = "Grade is required") String grade,
			@NotBlank(message = "Major is required") String major,
			@NotBlank(message = "Team selection is required") String team,
			@NotBlank(message = "batch Code selection is required") Long batchCode,
			@NotNull(message = "Start date is required") Date startDate,
			@NotNull(message = "End date is required") Date endDate,
			@NotNull(message = "Graduating year is required") @Min(value = 2020, message = "Graduating year must be >= 2020") Integer graduatingYear,
			@NotBlank(message = "Resume URL/path is required") String resume, String profilePic) {
		super();
		this.userName = userName;
		this.email = email;
		this.password = password;
		this.dob = dob;
		this.contactNo = contactNo;
		this.address = address;
		this.collegeName = collegeName;
		this.grade = grade;
		this.major = major;
		this.team = team;
		this.batchCode = batchCode;
		this.startDate = startDate;
		this.endDate = endDate;
		this.graduatingYear = graduatingYear;
		this.resume = resume;
		this.profilePic = profilePic;
	}

    // constructor + getters + setters
    // ... (same as previous but unchanged)
    
    public String getUserName() { return userName; }
    public void setUserName(String userName) { this.userName = userName; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }

    public Date getDob() { return dob; }
    public void setDob(Date dob) { this.dob = dob; }

    public String getContactNo() { return contactNo; }
    public void setContactNo(String contactNo) { this.contactNo = contactNo; }

    public String getAddress() { return address; }
    public void setAddress(String address) { this.address = address; }

    public String getCollegeName() { return collegeName; }
    public void setCollegeName(String collegeName) { this.collegeName = collegeName; }

    public String getGrade() { return grade; }
    public void setGrade(String grade) { this.grade = grade; }

    public String getMajor() { return major; }
    public void setMajor(String major) { this.major = major; }

    public String getTeam() { return team; }
    public void setTeam(String team) { this.team = team; }

    public Date getStartDate() { return startDate; }
    public void setStartDate(Date startDate) { this.startDate = startDate; }

    public Date getEndDate() { return endDate; }
    public void setEndDate(Date endDate) { this.endDate = endDate; }

    public Integer getGraduatingYear() { return graduatingYear; }
    public void setGraduatingYear(Integer graduatingYear) { this.graduatingYear = graduatingYear; }

    public String getResume() { return resume; }
    public void setResume(String resume) { this.resume = resume; }

    public String getProfilePic() { return profilePic; }
    public void setProfilePic(String profilePic) { this.profilePic = profilePic; }


	public Long getBatchCode() {
		return batchCode;
	}


	public void setBatchCode(Long batchCode) {
		this.batchCode = batchCode;
	}
}





package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.User;
import com.finalproject.internMgmtSystem.repository.UserDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

import java.sql.Types;
import java.util.List;

@Repository
public class UserDaoImpl implements UserDao {

	@Autowired
	private JdbcTemplate jdbcTemplate;

	private RowMapper<User> mapper = (rs, rowNum) -> {
		User u = new User();
		u.setUserId(rs.getLong("user_id"));
		u.setUserName(rs.getString("user_name"));
		u.setEmail(rs.getString("email"));
		u.setPassword(rs.getString("password"));
		u.setDob(rs.getDate("dob"));
		u.setContactNo(rs.getString("contact_no"));
		u.setAddress(rs.getString("address"));
		u.setCollegeName(rs.getString("college_name"));
		u.setGrade(rs.getString("grade"));
		u.setMajor(rs.getString("major"));
		u.setTeam(rs.getString("team"));
		u.setBatchCode(rs.getLong("batch_code"));
		u.setStartDate(rs.getDate("start_date"));
		u.setEndDate(rs.getDate("end_date"));
		u.setGraduatingYear(rs.getInt("graduating_year"));
		u.setResume(rs.getString("resume"));
		u.setProfilePic(rs.getString("profile_pic"));
		u.setRole(rs.getString("role"));
		u.setCreatedAt(rs.getTimestamp("created_at"));
		return u;
	};

	@Override
	public User save(User user) {
		String sql = """
				INSERT INTO users
				(user_name, email, password, dob, contact_no, address, college_name, grade, major,
				team, batch_code, start_date, end_date, graduating_year, resume, profile_pic, role)
				VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
				""";

		jdbcTemplate.update(sql, user.getUserName(), user.getEmail(), user.getPassword(), user.getDob(),
				user.getContactNo(), user.getAddress(), user.getCollegeName(), user.getGrade(), user.getMajor(),
				user.getTeam(), user.getBatchCode(), user.getStartDate(), user.getEndDate(), user.getGraduatingYear(),
				user.getResume(), user.getProfilePic(), user.getRole());

		Long id = jdbcTemplate.queryForObject("SELECT LAST_INSERT_ID()", Long.class);
		user.setUserId(id);
		return user;
	}

	@Override
	public User findByEmail(String email) {
		List<User> list = jdbcTemplate.query("SELECT * FROM users WHERE email = ?", mapper, email);
		return list.isEmpty() ? null : list.get(0);
	}

	@Override
	public User findById(Long id) {
		List<User> list = jdbcTemplate.query("SELECT * FROM users WHERE user_id = ?", mapper, id);
		return list.isEmpty() ? null : list.get(0);
	}

	@Override
	public List<User> findAll() {
		return jdbcTemplate.query("SELECT * FROM users", mapper);
	}

	@Override
	public void update(User user) {
		String sql = """
				    UPDATE users SET user_name=?, contact_no=?, address=?, college_name=?, grade=?, major=?,
				    team=?, start_date=?, end_date=?, graduating_year=?, resume=?, profile_pic=? WHERE user_id=?
				""";

		jdbcTemplate.update(sql, user.getUserName(), user.getContactNo(), user.getAddress(), user.getCollegeName(),
				user.getGrade(), user.getMajor(), user.getTeam(), user.getBatchCode(), user.getStartDate(),
				user.getEndDate(), user.getGraduatingYear(), user.getResume(), user.getProfilePic(), user.getUserId());
	}

	@Override
	public void deleteById(Long id) {
		jdbcTemplate.update("DELETE FROM users WHERE user_id = ?", id);
	}
}


package com.finalproject.internMgmtSystem.service;

import com.finalproject.internMgmtSystem.dto.FeedbackDto;
import com.finalproject.internMgmtSystem.dto.RegisterUserDto;
import com.finalproject.internMgmtSystem.exception.ResourceNotFoundException;
import com.finalproject.internMgmtSystem.exception.UserAlreadyExistsException;
import com.finalproject.internMgmtSystem.model.*;
import com.finalproject.internMgmtSystem.repository.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class UserService {

    @Autowired
    private UserDao userDao;

    @Autowired
    private TaskDao taskDao;

    @Autowired
    private PerformanceDao performanceDao;

    @Autowired
    private StipendDao stipendDao;

    @Autowired
    private BatchDao batchDao;

    @Autowired
    private FeedbackDao feedbackDao;

    @Autowired
    private AttendanceDao attendanceDao;

    @Autowired
    private PasswordEncoder passwordEncoder;

    public User registerUser(RegisterUserDto dto) {

        User exists = userDao.findByEmail(dto.getEmail());
        if (exists != null) {
            throw new UserAlreadyExistsException("User email already exists: " + dto.getEmail());
        }

        InternshipBatch batch = batchDao.findByBatchCode(dto.getBatchCode());
        if (batch == null) {
            throw new ResourceNotFoundException("Batch not found with code: " + dto.getBatchCode());
        }
        if (batch.getAvailableSeats() <= 0) {
            throw new ResourceNotFoundException("No available seats in batch: " + dto.getBatchCode());
        }
        batchDao.decrementAvailableSeats(dto.getBatchCode());

        User user = new User();
        user.setUserName(dto.getUserName());
        user.setEmail(dto.getEmail());
        user.setPassword(passwordEncoder.encode(dto.getPassword()));
        user.setDob(dto.getDob());
        user.setContactNo(dto.getContactNo());
        user.setAddress(dto.getAddress());
        user.setCollegeName(dto.getCollegeName());
        user.setGrade(dto.getGrade());
        user.setMajor(dto.getMajor());
        user.setTeam(dto.getTeam());
        user.setBatchCode(dto.getBatchCode());
        user.setStartDate(dto.getStartDate());
        user.setEndDate(dto.getEndDate());
        user.setGraduatingYear(dto.getGraduatingYear());
        user.setResume(dto.getResume());
        user.setProfilePic(dto.getProfilePic());
        user.setRole("USER");

        return userDao.save(user);
    }

    public List<Task> getTasks(Long userId) {
        return taskDao.findByUserId(userId); // ‚ú® Allow empty list
    }

    public List<Performance> getPerformance(Long userId) {
        return performanceDao.findByUserId(userId); // ‚ú® Allow empty list
    }

    public List<Stipend> getStipendHistory(Long userId) {
        return stipendDao.findByUserId(userId); // ‚ú® Allow empty list
    }

    public InternshipBatch getBatchDetails(Long batchCode) {
        InternshipBatch batch = batchDao.findById(batchCode);
        if (batch == null) {
            throw new ResourceNotFoundException("Batch not found with code: " + batchCode);
        }
        return batch;
    }

    public Feedback submitFeedback(FeedbackDto dto) {
        Feedback f = new Feedback();
        f.setUserId(dto.getUserId());
        f.setUserName(dto.getUserName());
        f.setBatchCode(dto.getBatchCode());
        f.setTrainerId(dto.getTrainerId());   // ‚≠ê ADD THIS
        f.setTrainerName(dto.getTrainerName());
        f.setFeedback(dto.getFeedback());
        f.setRating(dto.getRating());
        return feedbackDao.save(f);
    }


    public List<Attendance> getAttendance(Long userId) {
        return attendanceDao.findByUserId(userId); // ‚ú® Allow empty list
    }
}



package com.finalproject.internMgmtSystem.controller;

import com.finalproject.internMgmtSystem.dto.FeedbackDto;
import com.finalproject.internMgmtSystem.dto.RegisterUserDto;
import com.finalproject.internMgmtSystem.model.*;
import com.finalproject.internMgmtSystem.repository.BatchDao;
import com.finalproject.internMgmtSystem.service.UserService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/user")
@CrossOrigin
public class UserController {

    @Autowired
    private UserService userService;

    @Autowired
    private BatchDao batchDao; // üî• FIXED ‚Äî Autowired properly

    @PostMapping("/register")
    public User register(@Valid @RequestBody RegisterUserDto dto) {
        return userService.registerUser(dto);
    }

    @GetMapping("/{userId}/tasks")
    public List<Task> getTasks(@PathVariable Long userId) {
        return userService.getTasks(userId);
    }

    @GetMapping("/{userId}/performance")
    public List<Performance> getPerformance(@PathVariable Long userId) {
        return userService.getPerformance(userId);
    }

    @GetMapping("/{userId}/stipends")
    public List<Stipend> getStipends(@PathVariable Long userId) {
        return userService.getStipendHistory(userId);
    }

    @GetMapping("/batch/{batchCode}")
    public InternshipBatch getBatchDetails(@PathVariable Long batchCode) {
        return userService.getBatchDetails(batchCode);
    }

    @PostMapping("/feedback")
    public Feedback submitFeedback(@Valid @RequestBody FeedbackDto dto) {
        return userService.submitFeedback(dto);
    }

    @GetMapping("/{userId}/attendance")
    public List<Attendance> getAttendance(@PathVariable Long userId) {
        return userService.getAttendance(userId);
    }

    // üìå NEW PUBLIC ENDPOINT
    @GetMapping("/batches")
    public List<InternshipBatch> getAllBatchesPublic() {
        return batchDao.findAll(); // üü¢ Now resolved and working!
    }
}


import api from "./axiosConfig";

// USER REGISTRATION
export const registerUser = (data) => api.post("/api/user/register", data);

// PUBLIC BATCH LIST ‚Äî no login required
export const getAllBatchesPublic = () => api.get("/api/user/batches");

// USER FEATURES
export const getUserTasks = (id) => api.get(`/api/user/${id}/tasks`);
export const getUserPerformance = (id) => api.get(`/api/user/${id}/performance`);
export const getBatchDetails = (id) => api.get(`/api/user/batch/${id}`);
export const submitFeedback = (data) => api.post("/api/user/feedback", data);
export const getUserStipends = (id) => api.get(`/api/user/${id}/stipends`);
export const getUserAttendance = (id) => api.get(`/api/user/${id}/attendance`);





import React, { createContext, useState, useEffect } from "react";

export const AuthContext = createContext();

export default function AuthProvider({ children }) {
  const [token, setToken] = useState(localStorage.getItem("token"));
  const [role, setRole] = useState(localStorage.getItem("role"));
  const [email, setEmail] = useState(localStorage.getItem("email"));

  useEffect(() => {
    if (localStorage.getItem("token")) setToken(localStorage.getItem("token"));
    if (localStorage.getItem("role")) setRole(localStorage.getItem("role"));
    if (localStorage.getItem("email")) setEmail(localStorage.getItem("email"));
  }, []);

  const login = (newToken, newRole, newEmail) => {
    localStorage.setItem("token", String(newToken || ""));
    localStorage.setItem("role", String(newRole || ""));
    localStorage.setItem("email", String(newEmail || ""));

    setToken(String(newToken || ""));
    setRole(String(newRole || ""));
    setEmail(String(newEmail || ""));
  };

  const logout = () => {
    localStorage.clear();
    setToken(null);
    setRole(null);
    setEmail(null);
  };

  return (
    <AuthContext.Provider value={{ token, role, email, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}



import React, { useState, useContext } from "react";
import { loginApi } from "../../api/authApi";
import { AuthContext } from "../../context/AuthContext";
import { useNavigate } from "react-router-dom";
import "../../styles/login.css";
import AdminIllustration from "../../image/login.png";

export default function Login() {
  const { login } = useContext(AuthContext);
  const nav = useNavigate();
  const [form, setForm] = useState({ email: "", password: "" });
  const [err, setErr] = useState("");

  const parseJwtPayload = (token) => {
    try {
      const payload = JSON.parse(atob(token.split(".")[1]));
      return {
        role:
          typeof payload.role === "string"
            ? payload.role.startsWith("ROLE_")
              ? payload.role
              : `ROLE_${payload.role}`
            : "ROLE_USER",
        sub: payload.sub || "",
        userId: payload.userId,
        trainerId: payload.trainerId,
        trainerName: payload.trainerName,
        batchCode: payload.batchCode,
      };
    } catch {
      return {};
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setErr("");

    try {
      const res = await loginApi(form);
      const token = res.data.token; // ‚úî JSON response

      const { role, sub, userId, trainerId, trainerName, batchCode } =
        parseJwtPayload(token);

      login(token, role, String(sub)); // ‚úî Store token, role, email

      if (role === "ROLE_TRAINER") {
        localStorage.setItem("trainerId", String(trainerId || ""));
        localStorage.setItem("trainerName", String(trainerName || ""));
      }

      if (role === "ROLE_USER") {
        localStorage.setItem("userId", String(userId || ""));
        localStorage.setItem("batchCode", String(batchCode || ""));
      }

      if (role === "ROLE_ADMIN") nav("/admin/dashboard");
      else if (role === "ROLE_TRAINER") nav("/trainer/dashboard");
      else nav("/user/dashboard");
    } catch (error) {
      setErr(
        error?.response?.data?.message ||
          "Invalid credentials! Please enter correct email & password."
      );
    }
  };

  return (
    <div className="login-page">
      <div className="login-card">
        <div className="login-left enhanced-left">
          <div className="login-brand pop-in">
            <div className="brand-icon"><span className="brand-briefcase" /></div>
            <div className="brand-text">
              <div className="brand-title">INTERN-CONNECT</div>
              <div className="brand-subtitle">Portal</div>
            </div>
          </div>

          <div className="login-left-heading slide-up">
            <h1>Welcome Back üëã</h1>
            <p>Manage the entire internship workflow efficiently.</p>
          </div>

          <div className="login-illustration-wrapper float-up">
            <img src={AdminIllustration} alt="Illustration" className="login-illustration" />
          </div>
        </div>

        <div className="login-right">
          <button className="back-home-btn" onClick={() => nav("/")}>
            ‚Üê Home
          </button>

          <div className="login-right-header">
            <h2>Login Here</h2>
            <p>Enter your credentials to access dashboard</p>
          </div>

          {err && <div className="error">{err}</div>}

          <form className="form" onSubmit={handleSubmit}>
            <div className="input-group">
              <span className="input-icon">üë§</span>
              <input
                type="email"
                placeholder="Email"
                value={form.email}
                onChange={(e) =>
                  setForm({ ...form, email: e.target.value })
                }
                required
              />
            </div>

            <div className="input-group">
              <span className="input-icon">üîí</span>
              <input
                type="password"
                placeholder="Password"
                value={form.password}
                onChange={(e) =>
                  setForm({ ...form, password: e.target.value })
                }
                required
              />
            </div>

            <button className="btn" type="submit">
              LOGIN
            </button>

            <div className="switch-auth">
              <a href="/user/register">Register as User</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}




import React, { useState, useEffect } from "react";
import { registerUser, getAllBatchesPublic } from "../../api/userApi";
import formatError from "../../utils/formatError";
import { useNavigate } from "react-router-dom";
import "../../styles/registerUser.css";

export default function RegisterUser() {
  const [msg, setMsg] = useState("");
  const [batches, setBatches] = useState([]);
  const [currentStep, setCurrentStep] = useState(1);
  const navigate = useNavigate();

  const [form, setForm] = useState({
    userName: "",
    email: "",
    password: "",
    dob: "",
    contactNo: "",
    address: "",
    collegeName: "",
    grade: "",
    major: "",
    team: "",
    batchCode: "",
    startDate: "",
    endDate: "",
    graduatingYear: "",
    resume: "",
    profilePic: "",
  });

  useEffect(() => {
    loadBatches();
  }, []);

  const loadBatches = async () => {
    try {
      const res = await getAllBatchesPublic();
      setBatches(res.data);
    } catch (err) {
      console.error("Failed to load batches:", err);
    }
  };

  const handleChange = (e) => {
    setForm({ ...form, [e.target.name]: e.target.value });
  };

  const handleBatchSelect = (e) => {
    const val = Number(e.target.value);
    const selected = batches.find((b) => b.batchCode === val);

    if (!selected) return;

    setForm({
      ...form,
      batchCode: selected.batchCode,
      startDate: selected.startDate?.slice(0, 10),
      endDate: selected.endDate?.slice(0, 10),
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      await registerUser(form);
      setMsg("üéâ User Registered Successfully!");
      setTimeout(() => {
        navigate("/"); // redirect to login
      }, 1800);
    } catch (err) {
      setMsg(formatError(err));
      setTimeout(() => setMsg(""), 2000);
    }
  };

  const goNext = () => setCurrentStep((prev) => Math.min(prev + 1, 3));
  const goBack = () => setCurrentStep((prev) => Math.max(prev - 1, 1));

  const isSuccessMsg = msg.startsWith("üéâ");

  return (
    <div className="register-page">
      <div className="container register-container">
        <div className="register-card">

          {/* BACK TO HOME */}
          <button
            className="back-home-btn"
            onClick={() => navigate("/")}
          >
            ‚Üê Home
          </button>

          <div className="register-header">
            <h2>Intern Application</h2>
            <p>Fill in your details to apply for the internship program.</p>
          </div>

          {/* Stepper */}
          <div className="stepper">
            <div className={`step-item ${currentStep === 1 ? "active" : currentStep > 1 ? "completed" : ""}`}>
              <div className="step-circle">1</div>
              <span className="step-label">Personal Information</span>
            </div>

            <div className={`step-item ${currentStep === 2 ? "active" : currentStep > 2 ? "completed" : ""}`}>
              <div className="step-circle">2</div>
              <span className="step-label">Education</span>
            </div>

            <div className={`step-item ${currentStep === 3 ? "active" : ""}`}>
              <div className="step-circle">3</div>
              <span className="step-label">Uploads</span>
            </div>
          </div>

          {msg && (
            <p className={`alert-msg ${isSuccessMsg ? "success-msg" : "error-msg"}`}>
              {msg}
            </p>
          )}

          <form onSubmit={handleSubmit} className="register-form">

            {/* ================= STEP 1 ================= */}
            {currentStep === 1 && (
              <div className="step-content">

                <div className="section-title">Personal Information</div>

                <div className="field-row">
                  <div className="field">
                    <label>Full Name *</label>
                    <input required name="userName" placeholder="Your full name" onChange={handleChange} />
                  </div>
                </div>

                <div className="field-row">
                  <div className="field">
                    <label>Email *</label>
                    <input required name="email" type="email" placeholder="you@example.com" onChange={handleChange} />
                  </div>
                  <div className="field">
                    <label>Password *</label>
                    <input required name="password" type="password" placeholder="Create password" onChange={handleChange} />
                  </div>
                </div>

                <div className="field-row">
                  <div className="field">
                    <label>Date of Birth *</label>
                    <input required name="dob" type="date" onChange={handleChange} />
                  </div>
                  <div className="field">
                    <label>Contact No *</label>
                    <input required name="contactNo" placeholder="Mobile number" onChange={handleChange} />
                  </div>
                </div>

                <div className="field-row">
                  <div className="field">
                    <label>Address *</label>
                    <input required name="address" placeholder="Current address" onChange={handleChange} />
                  </div>
                </div>
              </div>
            )}

            {/* ================= STEP 2 ================= */}
            {currentStep === 2 && (
              <div className="step-content">
                <div className="section-title">Education & Internship Details</div>

                <div className="field-row">
                  <div className="field">
                    <label>College Name *</label>
                    <input required name="collegeName" placeholder="College / University" onChange={handleChange} />
                  </div>
                </div>

                <div className="field-row">
                  <div className="field">
                    <label>Grade</label>
                    <input name="grade" placeholder="e.g. 8.2 CGPA" onChange={handleChange} />
                  </div>
                  <div className="field">
                    <label>Major</label>
                    <input name="major" placeholder="e.g. Computer Science" onChange={handleChange} />
                  </div>
                </div>

                <div className="field-row">
                  <div className="field">
                    <label>Team (Optional)</label>
                    <input name="team" placeholder="Preferred team" onChange={handleChange} />
                  </div>
                  <div className="field">
                    <label>Graduation Year</label>
                    <input name="graduatingYear" placeholder="2026" onChange={handleChange} />
                  </div>
                </div>

                <div className="field-row">
                  <div className="field">
                    <label>Select Batch *</label>
                    <select
                      required
                      name="batchCode"
                      value={form.batchCode || ""}
                      onChange={handleBatchSelect}
                    >
                      <option value="">Choose a batch</option>
                      {batches.map((b) => (
                        <option key={b.batchCode} value={b.batchCode} disabled={b.availableSeats <= 0}>
                          {b.batchName} | {b.courseName} | Seats: {b.availableSeats}
                        </option>
                      ))}
                    </select>
                  </div>
                </div>

                <div className="field-row">
                  <div className="field">
                    <label>Start Date</label>
                    <input type="date" name="startDate" value={form.startDate || ""} readOnly />
                  </div>
                  <div className="field">
                    <label>End Date</label>
                    <input type="date" name="endDate" value={form.endDate || ""} readOnly />
                  </div>
                </div>
              </div>
            )}

            {/* ================= STEP 3 ================= */}
            {currentStep === 3 && (
              <div className="step-content">
                <div className="section-title">Uploads</div>

                <div className="field-row">
                  <div className="field">
                    <label>Resume URL</label>
                    <input name="resume" placeholder="Drive / Portfolio link" onChange={handleChange} />
                  </div>
                </div>

                <div className="field-row">
                  <div className="field">
                    <label>Profile Pic URL</label>
                    <input name="profilePic" placeholder="Photo URL link" onChange={handleChange} />
                  </div>
                </div>
              </div>
            )}

            {/* Step Navigation */}
            <div className="step-actions">
              {currentStep > 1 && (
                <button className="btn secondary-btn" type="button" onClick={goBack}>
                  ‚Üê Back
                </button>
              )}

              {currentStep < 3 && (
                <button className="btn next-btn" type="button" onClick={goNext}>
                  Next ‚Üí
                </button>
              )}

              {currentStep === 3 && (
                <button className="btn register-btn" type="submit">
                  Register Now ‚úî
                </button>
              )}
            </div>
          </form>

        </div>
      </div>
    </div>
  );
}


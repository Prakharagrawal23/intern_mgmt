package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Feedback;
import java.util.List;

public interface FeedbackDao {

    Feedback save(Feedback feedback);

    List<Feedback> findByTrainerName(String trainerName);

    List<Feedback> findByUserId(Long userId);

    List<Feedback> findAll();
    
    List<Feedback> findByTrainerId(Long trainerId);
}
package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.Feedback;
import com.finalproject.internMgmtSystem.repository.FeedbackDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public class FeedbackDaoImpl implements FeedbackDao {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    private RowMapper<Feedback> mapper = (rs, rowNum) -> {
        Feedback f = new Feedback();
        f.setId(rs.getLong("id"));
        f.setUserId(rs.getLong("user_id"));
        f.setUserName(rs.getString("user_name"));
        f.setBatchCode(rs.getLong("batch_code"));
        f.setTrainerName(rs.getString("trainer_name"));
        f.setDate(rs.getTimestamp("date"));
        f.setFeedback(rs.getString("feedback"));
        f.setRating(rs.getInt("rating"));
        return f;
    };

    @Override
    public Feedback save(Feedback feedback) {
        String sql = """
            INSERT INTO feedback (user_id, user_name, batch_code, trainer_name, feedback, rating)
            VALUES (?, ?, ?, ?, ?, ?)
        """;

        jdbcTemplate.update(sql,
                feedback.getUserId(),
                feedback.getUserName(),
                feedback.getBatchCode(),
                feedback.getTrainerName(),
                feedback.getFeedback(),
                feedback.getRating()
        );

        Long id = jdbcTemplate.queryForObject("SELECT LAST_INSERT_ID()", Long.class);
        feedback.setId(id);
        return feedback;
    }

    @Override
    public List<Feedback> findByTrainerName(String trainerName) {
        return jdbcTemplate.query(
                "SELECT * FROM feedback WHERE trainer_name = ? ORDER BY date DESC",
                mapper,
                trainerName
        );
    }

    @Override
    public List<Feedback> findByUserId(Long userId) {
        return jdbcTemplate.query(
                "SELECT * FROM feedback WHERE user_id = ? ORDER BY date DESC",
                mapper,
                userId
        );
    }

    @Override
    public List<Feedback> findAll() {
        return jdbcTemplate.query("SELECT * FROM feedback ORDER BY date DESC", mapper);
    }
    
    

    @Override
    public List<Feedback> findByTrainerId(Long trainerId) {
        return jdbcTemplate.query(
                "SELECT * FROM feedback WHERE trainer_id = ? ORDER BY date DESC",
                mapper,
                trainerId
        );
    }


}
+----------------------------+
| Tables_in_internmgmtsystem |
+----------------------------+
| attendance                 |
| feedback                   |
| internship_batches         |
| performance                |
| stipend                    |
| tasks                      |
| trainers                   |
| users                      |
+----------------------------+
8 rows in set (0.04 sec)

mysql> select * from feedback;
+----+---------+---------------+------------+-----------------+---------------------+-------------------------+--------+
| id | user_id | user_name     | batch_code | trainer_name    | date                | feedback                | rating |
+----+---------+---------------+------------+-----------------+---------------------+-------------------------+--------+
|  1 |       1 | Prakhar       |          1 | Ram Kumar       | 2025-11-20 21:27:09 | Amazing teaching style! |      5 |
|  2 |       2 | Rohan         |          2 | Amit Verma      | 2025-11-20 21:27:09 | Great ML mentorship!    |      4 |
|  3 |      13 | Rohit Sharma2 |          4 | prakhar agrawal | 2025-11-25 00:10:34 | okay okay               |      4 |
+----+---------+---------------+------------+-----------------+---------------------+-------------------------+--------+
3 rows in set (0.00 sec)

mysql> select * from trainers;
+------------+-------------------+--------------------------+--------------------------------------------------------------+------------+------------+--------------------------+----------------+-----------------------+---------+---------------------+
| trainer_id | name              | email                    | password                                                     | contact    | experience | skills                   | profile_pic    | bio                   | role    | created_at          |
+------------+-------------------+--------------------------+--------------------------------------------------------------+------------+------------+--------------------------+----------------+-----------------------+---------+---------------------+
|          1 | Ram Kumar         | ram.trainer@gmail.com    | $2a$10$JDEuSRh4AcG0l2U1BjQVgO4h1.xZ9vq5P1XRg8Mm1Nn.4y2mauCGe | 9876543210 |          5 | Java, Spring Boot, MySQL | ram.jpg        | Senior Java Trainer   | TRAINER | 2025-11-22 15:42:13 |
|          2 | Amit Verma        | amit.trainer@gmail.com   | $2a$10$JDEuSRh4AcG0l2U1BjQVgO4h1.xZ9vq5P1XRg8Mm1Nn.4y2mauCGe | 9898989898 |          8 | Python, Django, ML       | amit.png       | Python & ML Mentor    | TRAINER | 2025-11-22 15:42:13 |
|          3 | prakhar agrawal   | prakhar@gmail.com        | $2a$10$Eroa1vqaonTEQdxaFdMD0.zhSZ7dcTau7cPqWoVs..6AAckjYMT2C | 9898983298 |          4 | python dev               | prakhar.jpg    | Senior python Trainer | TRAINER | 2025-11-22 15:42:13 |
|          5 | iron man          | iron@gmail.com           | $2a$10$Czs.fTJMfBd16CWx03MrlOK1fC5kbGdbfQKAthgRBcirt9LbkYXoW | 98989298   |          5 | tech                     | iron.jpg       | Senior Trainer        | TRAINER | 2025-11-23 01:47:15 |
|          9 | prakhar           | prakhar.ag9839@gmail.com | $2a$10$NBul6dhiWlggwqceyWuX4euiIGXwAfPf36Ojivw0RJvS640xppTBq | 8887876211 |          5 | java core                | prakharpic.jpg | Senior java Trainer   | TRAINER | 2025-11-24 21:57:10 |
|         15 | prakhar agrawal 2 | prakhar.ag1123@gmail.com | $2a$10$LsccJnHxXIgnvuIsquIEx.BqBHPWqDAhQZ8qLqRMKUdmBny5GLju. | 8887876118 |          6 | python, java             | prakhar.png    | hello                 | TRAINER | 2025-11-29 01:39:08 |
+------------+-------------------+--------------------------+--------------------------------------------------------------+------------+------------+--------------------------+----------------+-----------------------+---------+---------------------+
6 rows in set (0.00 sec)

mysql>

import React, { useEffect, useState } from "react";
import { getBatchDetails } from "../../api/userApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import { useParams } from "react-router-dom";

export default function BatchDetails() {
  const { batchCode } = useParams();
  const [batch, setBatch] = useState(null);

  useEffect(() => {
    const fetch = async () => {
      if (!batchCode) return;
      try {
        const res = await getBatchDetails(batchCode);
        setBatch(res.data);
      } catch (e) {
        console.error(e);
      }
    };
    fetch();
  }, [batchCode]);

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/user/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>Batch Details</h3>
        {!batch ? <div>No batch found.</div> : (
          <div>
            <p><b>Name:</b> {batch.batchName}</p>
            <p><b>Course:</b> {batch.courseName}</p>
            <p><b>Trainer ID:</b> {batch.trainerId}</p>
            <p><b>Seats:</b> {batch.availableSeats}/{batch.totalSeats}</p>
          </div>
        )}
      </div>
    </div>
  );
}



import React, { useState, useEffect } from "react";
import { submitFeedback } from "../../api/userApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";

export default function FeedbackForm() {
  const [form, setForm] = useState({
    userId: "",
    userName: "",
    batchCode: "",
    trainerId: "",     // â­ ADDED
    trainerName: "",
    feedback: "",
    rating: 5,
  });

  const [msg, setMsg] = useState("");

  // Auto pre-fill from localStorage
  useEffect(() => {
    setForm((prev) => ({
      ...prev,
      userId: String(localStorage.getItem("userId") || ""),
      userName: String(localStorage.getItem("email") || ""),
      batchCode: String(localStorage.getItem("batchCode") || ""),
      // If you store trainerId somewhere (e.g. when user selects trainer)
      trainerId: String(localStorage.getItem("trainerId") || ""),
      trainerName: String(localStorage.getItem("trainerName") || ""),
    }));
  }, []);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setMsg("");

    if (!form.feedback.trim()) {
      setMsg("Please write feedback before submitting!");
      return;
    }

    // Build payload with correct types
    const payload = {
      userId: form.userId ? Number(form.userId) : null,
      userName: form.userName,
      batchCode: form.batchCode ? Number(form.batchCode) : null,
      trainerId: form.trainerId ? Number(form.trainerId) : null,  // â­ IMPORTANT
      trainerName: form.trainerName,
      feedback: form.feedback,
      rating: Number(form.rating),
    };

    try {
      await submitFeedback(payload);
      setMsg("Feedback submitted successfully âœ”");
      setTimeout(() => setMsg(""), 2500);
      setForm((prev) => ({ ...prev, feedback: "" }));
    } catch (e) {
      const data = e?.response?.data;

      let text = "Failed to submit!";
      if (typeof data === "string") {
        text = data;
      } else if (data && typeof data === "object") {
        // Common case for validation errors
        // Example: { trainerId: "Trainer ID is required", rating: "..." }
        const parts = [];
        for (const key in data) {
          if (Object.prototype.hasOwnProperty.call(data, key)) {
            parts.push(`${key}: ${data[key]}`);
          }
        }
        if (parts.length) {
          text = parts.join(" | ");
        } else {
          text = JSON.stringify(data);
        }
      }

      setMsg(text); // always a STRING â†’ React safe
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/user/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>Give Feedback</h3>

        {msg && <div className="info">{msg}</div>}

        <form className="small-form" onSubmit={handleSubmit}>
          {/* User ID (read-only) */}
          <input value={form.userId} disabled />

          {/* User name (read-only or editable as you wish) */}
          <input value={form.userName} disabled />

          {/* Batch Code */}
          <input
            value={form.batchCode}
            onChange={(e) =>
              setForm({ ...form, batchCode: e.target.value })
            }
            placeholder="Batch Code"
            required
          />

          {/* Trainer ID (optional visible or hidden) */}
          {/* You can hide this input if you don't want user to see it */}
          <input
            value={form.trainerId}
            onChange={(e) =>
              setForm({ ...form, trainerId: e.target.value })
            }
            placeholder="Trainer ID (optional or auto-filled)"
          />

          {/* Trainer Name */}
          <input
            value={form.trainerName}
            onChange={(e) =>
              setForm({ ...form, trainerName: e.target.value })
            }
            placeholder="Trainer Name"
            required
          />

          {/* Feedback Text */}
          <textarea
            placeholder="Write your feedback here..."
            value={form.feedback}
            onChange={(e) =>
              setForm({ ...form, feedback: e.target.value })
            }
            required
          />

          {/* Rating */}
          <input
            type="number"
            min="1"
            max="5"
            value={form.rating}
            onChange={(e) =>
              setForm({ ...form, rating: Number(e.target.value) })
            }
            required
          />

          <button className="btn" type="submit">
            Submit
          </button>
        </form>
      </div>
    </div>
  );
}



import React, { useEffect, useState } from "react";
import { getUserAttendance } from "../../api/userApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import formatDate from "../../utils/formatDate";

export default function UserAttendance() {
  const userId = localStorage.getItem("userId");
  const [data, setData] = useState([]);

  useEffect(() => {
    if (!userId) return;
    getUserAttendance(userId).then(res => setData(res.data)).catch(console.error);
  }, [userId]);

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/user/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>Attendance Record</h3>
        {data.length === 0 ? "No attendance records" :
          <table className="table">
            <thead><tr><th>Date</th><th>Status</th></tr></thead>
            <tbody>
              {data.map(a => (
                <tr key={a.attendanceId}>
                  <td>{formatDate(a.date)}</td>
                  <td>{a.present ? "Present" : "Absent"}</td>
                </tr>
              ))}
            </tbody>
          </table>
        }
      </div>
    </div>
  );
}



import React, { useEffect, useState } from "react";
import { getUserPerformance, getBatchDetails } from "../../api/userApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import formatDate from "../../utils/formatDate";
import "../../styles/performance.css";

export default function UserPerformance() {
  const userId = localStorage.getItem("userId");
  const [perf, setPerf] = useState([]);
  const [batchDetails, setBatchDetails] = useState(null);

  const fetchBatchDetails = async (batchCode) => {
    if (!batchCode) return;
    try {
      const res = await getBatchDetails(batchCode);
      setBatchDetails(res.data);
    } catch (err) {
      console.error("Failed fetching batch details", err);
    }
  };

  useEffect(() => {
    if (!userId) return;
    getUserPerformance(userId)
      .then((res) => setPerf(res.data))
      .catch((err) => console.error("API Error", err));
  }, [userId]);

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/user/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h2 className="title">ðŸ“Š My Performance</h2>

        {perf.length === 0 ? (
          <p className="no-data">No performance records available.</p>
        ) : (
          <table className="table performance-table">
            <thead>
              <tr>
                <th>Trainer</th>
                <th>Batch</th>
                <th>Score</th>
                <th>Remarks</th>
                <th>Date</th>
              </tr>
            </thead>

            <tbody>
              {perf.map((p) => (
                <tr key={p.id} onClick={() => fetchBatchDetails(p.batchCode)}>
                  <td>{p.trainerName || "N/A"}</td>
                  <td>{p.batchCode || "N/A"}</td>
                  <td>
                    <span
                      className={`score-badge ${
                        p.taskEvaluationScore >= 80
                          ? "score-high"
                          : p.taskEvaluationScore >= 50
                          ? "score-medium"
                          : "score-low"
                      }`}
                    >
                      {p.taskEvaluationScore}
                    </span>
                  </td>
                  <td>{p.remarks}</td>
                  <td>{p.createdAt ? formatDate(p.createdAt) : "N/A"}</td>
                </tr>
              ))}
            </tbody>
          </table>
        )}

        {batchDetails && (
          <div className="batch-card">
            <h3>Batch Details</h3>

            <p><strong>Batch Name:</strong> {batchDetails.batchName}</p>
            <p><strong>Course:</strong> {batchDetails.courseName}</p>
            <p><strong>Trainer ID:</strong> {batchDetails.trainerId}</p>
            <p><strong>Start:</strong> {formatDate(batchDetails.startDate)}</p>
            <p><strong>End:</strong> {formatDate(batchDetails.endDate)}</p>

            <button className="btn-close" onClick={() => setBatchDetails(null)}>
              Close
            </button>
          </div>
        )}
      </div>
    </div>
  );
}



import React, { useEffect, useState } from "react";
import { getUserStipends } from "../../api/userApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import formatDate from "../../utils/formatDate";

export default function UserStipends() {
  const userId = localStorage.getItem("userId");
  const [data, setData] = useState([]);

  useEffect(() => {
    if (!userId) return;
    getUserStipends(userId).then(res => setData(res.data)).catch(console.error);
  }, [userId]);

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/user/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>My Stipends</h3>
        {data.length === 0 ? "No stipend records" :
          <table className="table">
            <thead><tr><th>Amount</th><th>Mode</th><th>Date</th></tr></thead>
            <tbody>
              {data.map(s => (
                <tr key={s.id}>
                  <td>{s.amount}</td>
                  <td>{s.paymentMode}</td>
                  <td>{formatDate(s.paymentDate)}</td>
                </tr>
              ))}
            </tbody>

          </table>
        }
      </div>
    </div>
  );
}



import React, { useEffect, useState } from "react";
import { getUserTasks } from "../../api/userApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import formatDate from "../../utils/formatDate";
// import "../../styles/tasks.css";

export default function UserTasks() {
  const userId = localStorage.getItem("userId");
  const [tasks, setTasks] = useState([]);

  useEffect(() => {
    if (!userId) return;
    getUserTasks(userId)
      .then((res) => {
        console.log("Tasks:", res.data);
        setTasks(res.data || []);
      })
      .catch(console.error);
  }, [userId]);

  const getStatusClass = (status) => {
    switch (status) {
      case "COMPLETED":
        return "status-green";
      case "ONGOING":
        return "status-orange";
      default:
        return "status-gray";
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/user/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>Tasks</h3>

        {tasks.length === 0 ? (
          <p>No tasks found.</p>
        ) : (
          <table className="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Description</th>
                <th>Status</th>
                <th>Deadline</th>
              </tr>
            </thead>

            <tbody>
              {tasks.map((t, idx) => (
                <tr key={t.id || `fallback-${idx}`}>
                  <td>{t.id || "-"}</td>
                  <td>{t.description}</td>
                  <td>
                    <span className={`task-status ${getStatusClass(t.status)}`}>
                      {t.status}
                    </span>
                  </td>
                  <td>{t.deadline ? formatDate(t.deadline) : "N/A"}</td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
}

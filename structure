trainerApi.js:9 
 
 PUT http://localhost:9090/api/trainer/tasks/7 400 (Bad Request)
UpdateTask.jsx:61 
 
AxiosError {message: 'Request failed with status code 400', name: 'AxiosError', code: 'ERR_BAD_REQUEST', config: {‚Ä¶}, request: XMLHttpRequest, ‚Ä¶}
Ôªø
Edit Task
Failed to update task ‚ùå
Description
hello
Deadline

12/06/2025
Status

ONGOING
Update Task


import api from "./axiosConfig";

export const getTrainerBatches = (id) =>
  api.get(`/api/trainer/batches/${id}`);

export const createTask = (data) =>
  api.post("/api/trainer/tasks", data);

export const updateTask = (taskId, data) =>
  api.put(`/api/trainer/tasks/${taskId}`, data);

export const deleteTask = (taskId) =>
  api.delete(`/api/trainer/tasks/${taskId}`);

export const markAttendance = (data) =>
  api.post("/api/trainer/attendance", data);

export const givePerformance = (data) =>
  api.post("/api/trainer/performance", data);

export const getUsersByTrainerId = (trainerId) =>
  api.get(`/api/trainer/UserBatch/${trainerId}`);

export const getTasksByTrainerId = (trainerId) =>
  api.get(`/api/trainer/tasks/${trainerId}`);

// ‚≠ê Correct Feedback API using trainerId
export const getFeedbackByTrainerId = (trainerId) =>
  api.get(`/api/trainer/feedback/id/${trainerId}`);



import React, { createContext, useState, useEffect } from "react";

export const AuthContext = createContext();

export default function AuthProvider({ children }) {
  const [token, setToken] = useState(localStorage.getItem("token"));
  const [role, setRole] = useState(localStorage.getItem("role"));
  const [email, setEmail] = useState(localStorage.getItem("email"));

  useEffect(() => {
    if (localStorage.getItem("token")) setToken(localStorage.getItem("token"));
    if (localStorage.getItem("role")) setRole(localStorage.getItem("role"));
    if (localStorage.getItem("email")) setEmail(localStorage.getItem("email"));
  }, []);

  const login = (newToken, newRole, newEmail) => {
    localStorage.setItem("token", String(newToken || ""));
    localStorage.setItem("role", String(newRole || ""));
    localStorage.setItem("email", String(newEmail || ""));

    setToken(String(newToken || ""));
    setRole(String(newRole || ""));
    setEmail(String(newEmail || ""));
  };

  const logout = () => {
    localStorage.clear();
    setToken(null);
    setRole(null);
    setEmail(null);
  };

  return (
    <AuthContext.Provider value={{ token, role, email, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}



import React, { useState, useContext } from "react";
import { loginApi } from "../../api/authApi";
import { AuthContext } from "../../context/AuthContext";
import { useNavigate } from "react-router-dom";
import "../../styles/login.css";
import AdminIllustration from "../../image/login.png";

export default function Login() {
  const { login } = useContext(AuthContext);
  const nav = useNavigate();
  const [form, setForm] = useState({ email: "", password: "" });
  const [err, setErr] = useState("");

  const parseJwtPayload = (token) => {
    try {
      const payload = JSON.parse(atob(token.split(".")[1]));
      return {
        role:
          typeof payload.role === "string"
            ? payload.role.startsWith("ROLE_")
              ? payload.role
              : `ROLE_${payload.role}`
            : "ROLE_USER",
        sub: payload.sub || "",
        userId: payload.userId,
        trainerId: payload.trainerId,
        trainerName: payload.trainerName,
        batchCode: payload.batchCode,
      };
    } catch {
      return {};
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setErr("");

    try {
      const res = await loginApi(form);
      const token = res.data.token; // ‚úî JSON response

      const { role, sub, userId, trainerId, trainerName, batchCode } =
        parseJwtPayload(token);

      login(token, role, String(sub)); // ‚úî Store token, role, email

      if (role === "ROLE_TRAINER") {
        localStorage.setItem("trainerId", String(trainerId || ""));
        localStorage.setItem("trainerName", String(trainerName || ""));
      }

      if (role === "ROLE_USER") {
        localStorage.setItem("userId", String(userId || ""));
        localStorage.setItem("batchCode", String(batchCode || ""));
      }

      if (role === "ROLE_ADMIN") nav("/admin/dashboard");
      else if (role === "ROLE_TRAINER") nav("/trainer/dashboard");
      else nav("/user/dashboard");
    } catch (error) {
      setErr(
        error?.response?.data?.message ||
          "Invalid credentials! Please enter correct email & password."
      );
    }
  };

  return (
    <div className="login-page">
      <div className="login-card">
        <div className="login-left enhanced-left">
          <div className="login-brand pop-in">
            <div className="brand-icon"><span className="brand-briefcase" /></div>
            <div className="brand-text">
              <div className="brand-title">INTERN-CONNECT</div>
              <div className="brand-subtitle">Portal</div>
            </div>
          </div>

          <div className="login-left-heading slide-up">
            <h1>Welcome Back üëã</h1>
            <p>Manage the entire internship workflow efficiently.</p>
          </div>

          <div className="login-illustration-wrapper float-up">
            <img src={AdminIllustration} alt="Illustration" className="login-illustration" />
          </div>
        </div>

        <div className="login-right">
          <button className="back-home-btn" onClick={() => nav("/")}>
            ‚Üê Home
          </button>

          <div className="login-right-header">
            <h2>Login Here</h2>
            <p>Enter your credentials to access dashboard</p>
          </div>

          {err && <div className="error">{err}</div>}

          <form className="form" onSubmit={handleSubmit}>
            <div className="input-group">
              <span className="input-icon">üë§</span>
              <input
                type="email"
                placeholder="Email"
                value={form.email}
                onChange={(e) =>
                  setForm({ ...form, email: e.target.value })
                }
                required
              />
            </div>

            <div className="input-group">
              <span className="input-icon">üîí</span>
              <input
                type="password"
                placeholder="Password"
                value={form.password}
                onChange={(e) =>
                  setForm({ ...form, password: e.target.value })
                }
                required
              />
            </div>

            <button className="btn" type="submit">
              LOGIN
            </button>

            <div className="switch-auth">
              <a href="/user/register">Register as User</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}



import React, { useEffect, useState } from "react";
import { updateTask, getTasksByTrainerId } from "../../api/trainerApi";
import { useParams, useNavigate } from "react-router-dom";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/trainer-pages.css";

export default function UpdateTask() {
  const { taskId } = useParams();
  const navigate = useNavigate();
  const trainerId = Number(localStorage.getItem("trainerId"));

  const [form, setForm] = useState({
    userId: null,
    trainerId,
    description: "",
    status: "PENDING",
    deadline: ""
  });

  const [msg, setMsg] = useState("");

  useEffect(() => {
    const loadTask = async () => {
      try {
        const res = await getTasksByTrainerId(trainerId);
        const task = res.data.find(t => t.id === taskId);

        if (task) {
          setForm({
            userId: task.userId,
            trainerId: task.trainerId,
            description: task.description,
            status: task.status,
            deadline: task.deadline ? task.deadline.split("T")[0] : ""
          });
        }
      } catch (e) {
        console.error(e);
      }
    };
    loadTask();
  }, [taskId, trainerId]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      await updateTask(taskId, {
        userId: form.userId,
        trainerId: form.trainerId,
        description: form.description,
        status: form.status,
        deadline: form.deadline,
        uploadFile: null
      });

      setMsg("‚úî Task updated successfully!");
      setTimeout(() => navigate("/trainer/tasks"), 1000);
    } catch (e) {
      setMsg("Failed to update task ‚ùå");
      console.error(e);
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />
      <div className="main">
        <h3>Edit Task</h3>

        {msg && <div className="info">{msg}</div>}

        <form className="small-form" onSubmit={handleSubmit}>
          <label>Description</label>
          <textarea
            value={form.description}
            onChange={(e) => setForm({ ...form, description: e.target.value })}
          />

          <label>Deadline</label>
          <input
            type="date"
            value={form.deadline}
            onChange={(e) => setForm({ ...form, deadline: e.target.value })}
          />

          <label>Status</label>
          <select
            value={form.status}
            onChange={(e) => setForm({ ...form, status: e.target.value })}
          >
            <option>PENDING</option>
            <option>ONGOING</option>
            <option>COMPLETED</option>
          </select>

          <button className="btn" type="submit">Update Task</button>
        </form>
      </div>
    </div>
  );
}



import React, { useEffect, useState } from "react";
import { getTasksByTrainerId, deleteTask } from "../../api/trainerApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import { Link } from "react-router-dom";
import "../../styles/trainer-pages.css";

export default function TrainerViewTasks() {
  const trainerId = localStorage.getItem("trainerId");
  const [tasks, setTasks] = useState([]);
  const [msg, setMsg] = useState("");

  useEffect(() => {
    const fetchTasks = async () => {
      try {
        const res = await getTasksByTrainerId(trainerId);
        setTasks(res.data || []);
      } catch (e) {
        console.error(e);
        setMsg("Failed to load tasks");
      }
    };

    fetchTasks();
  }, [trainerId]);

  const removeTask = async (taskId) => {
    try {
      await deleteTask(taskId);
      setMsg("Task deleted successfully");

      // Reload tasks after deletion
      const res = await getTasksByTrainerId(trainerId);
      setTasks(res.data || []);
    } catch (err) {
      setMsg("Failed to delete task");
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>My Assigned Tasks</h3>
        {msg && <div className="info">{msg}</div>}

        {tasks.length === 0 ? (
          <p>No tasks assigned yet.</p>
        ) : (
          <table className="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Intern ID</th>
                <th>Description</th>
                <th>Status</th>
                <th>Deadline</th>
                <th>Actions</th>
              </tr>
            </thead>

            <tbody>
              {tasks.map((t) => (
                <tr key={t.id}>
                  <td>{t.id}</td>
                  <td>{t.userId}</td>
                  <td>{t.description}</td>
                  <td>{t.status}</td>
                  <td>{t.deadline || "N/A"}</td>

                  <td>
                    <Link className="btn small"
                      to={`/trainer/update-task/${t.id}`}
                    >
                      Edit
                    </Link>

                    <button
                      className="btn small danger"
                      onClick={() => removeTask(t.id)}
                      style={{ marginLeft: 8 }}
                    >
                      Delete
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
}



import React, { useState, useEffect } from "react";
import { createTask, getUsersByTrainerId } from "../../api/trainerApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import "../../styles/trainer-pages.css";


export default function CreateTask() {
  const trainerId = localStorage.getItem("trainerId");
  const trainerName = localStorage.getItem("trainerName");

  const [form, setForm] = useState({
    userId: "",
    trainerId,
    description: "",
    status: "PENDING",
    deadline: "",
    uploadFile: null,
  });

  const [users, setUsers] = useState([]);
  const [msg, setMsg] = useState("");
  const [error, setError] = useState("");

  useEffect(() => {
    if (trainerId) {
      getUsersByTrainerId(trainerId)
        .then((res) => setUsers(res.data))
        .catch((err) =>
          console.error("Failed to load user list for trainer:", err)
        );
    }
  }, [trainerId]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setMsg("");
    setError("");

    if (!form.userId || !form.description) {
      setError("‚ö† Please fill all required fields!");
      return;
    }

    try {
      await createTask({
        userId: Number(form.userId),
        trainerId: Number(trainerId),
        description: form.description,
        status: form.status,
        deadline: form.deadline,
        uploadFile: form.uploadFile,
      });

      setMsg("Task Assigned Successfully ‚úî");
      setForm({
        ...form,
        userId: "",
        description: "",
        deadline: "",
        status: "PENDING",
        uploadFile: null,
      });
    } catch (err) {
      const backendMsg =
        err.response?.data?.message ||
        err.response?.data ||
        "Failed to create task";
      setError(String(backendMsg));
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/trainer/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>Create Task</h3>

        {msg && <div className="info success">{msg}</div>}
        {error && <div className="info error">{error}</div>}

        <form className="small-form" onSubmit={handleSubmit}>
          <label>Trainer</label>
          <input value={trainerName} disabled />

          <label>Assign To (Intern)</label>
          <select
            value={form.userId}
            onChange={(e) => setForm({ ...form, userId: e.target.value })}
          >
            <option value="">-- Select Intern --</option>
            {users.map((u) => (
              <option key={u.userId} value={u.userId}>
                {u.userName} (Batch {u.batchCode})
              </option>
            ))}
          </select>

          <label>Description</label>
          <textarea
            placeholder="Describe task here..."
            value={form.description}
            onChange={(e) =>
              setForm({ ...form, description: e.target.value })
            }
          ></textarea>

          <label>Deadline</label>
          <input
            type="date"
            value={form.deadline}
            onChange={(e) =>
              setForm({ ...form, deadline: e.target.value })
            }
          />

          <label>Status</label>
          <select
            value={form.status}
            onChange={(e) => setForm({ ...form, status: e.target.value })}
          >
            <option>PENDING</option>
            <option>ONGOING</option>
            <option>COMPLETED</option>
          </select>

          <button className="btn" type="submit">
            Assign Task
          </button>
        </form>
      </div>
    </div>
  );
}



import React, { useEffect, useState } from "react";
import { getUserTasks } from "../../api/userApi";
import Navbar from "../../components/Navbar";
import Sidebar from "../../components/Sidebar";
import formatDate from "../../utils/formatDate";
import "../../styles/tasks.css";

export default function UserTasks() {
  const userId = localStorage.getItem("userId");
  const [tasks, setTasks] = useState([]);

  useEffect(() => {
    if (!userId) return;
    getUserTasks(userId)
      .then((res) => {
        console.log("Tasks:", res.data);
        setTasks(res.data || []);
      })
      .catch(console.error);
  }, [userId]);

  const getStatusClass = (status) => {
    switch (status) {
      case "COMPLETED":
        return "status-green";
      case "ONGOING":
        return "status-orange";
      default:
        return "status-gray";
    }
  };

  return (
    <div className="layout">
      <Navbar />
      <Sidebar items={[{ to: "/user/dashboard", label: "Dashboard" }]} />

      <div className="main">
        <h3>Tasks</h3>

        {tasks.length === 0 ? (
          <p>No tasks found.</p>
        ) : (
          <table className="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Description</th>
                <th>Status</th>
                <th>Deadline</th>
              </tr>
            </thead>

            <tbody>
              {tasks.map((t, idx) => (
                <tr key={t.id || `fallback-${idx}`}>
                  <td>{t.id || "-"}</td>
                  <td>{t.description}</td>
                  <td>
                    <span className={`task-status ${getStatusClass(t.status)}`}>
                      {t.status}
                    </span>
                  </td>
                  <td>{t.deadline ? formatDate(t.deadline) : "N/A"}</td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
}

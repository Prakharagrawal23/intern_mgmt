package com.finalproject.internMgmtSystem.dto;

import jakarta.validation.constraints.*;
import java.sql.Date;

public class RegisterUserDto {

    
	@NotBlank(message = "User name is required")
    private String userName;

    @NotBlank(message = "Email is required")
    @Email(message = "Enter a valid email")
    private String email;

    @NotBlank(message = "Password is required")
    private String password;

    @NotNull(message = "Date of birth is required")
    private Date dob;

    @NotBlank(message = "Contact number is required")
    private String contactNo;

    @NotBlank(message = "Address is required")
    private String address;

    @NotBlank(message = "College name is required")
    private String collegeName;

    @NotBlank(message = "Grade is required")
    private String grade;

    @NotBlank(message = "Major is required")
    private String major;

    @NotBlank(message = "Team selection is required")
    private String team;
    
    @NotBlank(message = "batch Code selection is required")
    private Long batchCode;
    		
    @NotNull(message = "Start date is required")
    private Date startDate;

    @NotNull(message = "End date is required")
    private Date endDate;

    @NotNull(message = "Graduating year is required")
    @Min(value = 2020, message = "Graduating year must be >= 2020")
    private Integer graduatingYear;

    @NotBlank(message = "Resume URL/path is required")
    private String resume;

    private String profilePic;

    public RegisterUserDto() {}
    
    
    public RegisterUserDto(@NotBlank(message = "User name is required") String userName,
			@NotBlank(message = "Email is required") @Email(message = "Enter a valid email") String email,
			@NotBlank(message = "Password is required") String password,
			@NotNull(message = "Date of birth is required") Date dob,
			@NotBlank(message = "Contact number is required") String contactNo,
			@NotBlank(message = "Address is required") String address,
			@NotBlank(message = "College name is required") String collegeName,
			@NotBlank(message = "Grade is required") String grade,
			@NotBlank(message = "Major is required") String major,
			@NotBlank(message = "Team selection is required") String team,
			@NotBlank(message = "batch Code selection is required") Long batchCode,
			@NotNull(message = "Start date is required") Date startDate,
			@NotNull(message = "End date is required") Date endDate,
			@NotNull(message = "Graduating year is required") @Min(value = 2020, message = "Graduating year must be >= 2020") Integer graduatingYear,
			@NotBlank(message = "Resume URL/path is required") String resume, String profilePic) {
		super();
		this.userName = userName;
		this.email = email;
		this.password = password;
		this.dob = dob;
		this.contactNo = contactNo;
		this.address = address;
		this.collegeName = collegeName;
		this.grade = grade;
		this.major = major;
		this.team = team;
		this.batchCode = batchCode;
		this.startDate = startDate;
		this.endDate = endDate;
		this.graduatingYear = graduatingYear;
		this.resume = resume;
		this.profilePic = profilePic;
	}

    // constructor + getters + setters
    // ... (same as previous but unchanged)
    
    public String getUserName() { return userName; }
    public void setUserName(String userName) { this.userName = userName; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }

    public Date getDob() { return dob; }
    public void setDob(Date dob) { this.dob = dob; }

    public String getContactNo() { return contactNo; }
    public void setContactNo(String contactNo) { this.contactNo = contactNo; }

    public String getAddress() { return address; }
    public void setAddress(String address) { this.address = address; }

    public String getCollegeName() { return collegeName; }
    public void setCollegeName(String collegeName) { this.collegeName = collegeName; }

    public String getGrade() { return grade; }
    public void setGrade(String grade) { this.grade = grade; }

    public String getMajor() { return major; }
    public void setMajor(String major) { this.major = major; }

    public String getTeam() { return team; }
    public void setTeam(String team) { this.team = team; }

    public Date getStartDate() { return startDate; }
    public void setStartDate(Date startDate) { this.startDate = startDate; }

    public Date getEndDate() { return endDate; }
    public void setEndDate(Date endDate) { this.endDate = endDate; }

    public Integer getGraduatingYear() { return graduatingYear; }
    public void setGraduatingYear(Integer graduatingYear) { this.graduatingYear = graduatingYear; }

    public String getResume() { return resume; }
    public void setResume(String resume) { this.resume = resume; }

    public String getProfilePic() { return profilePic; }
    public void setProfilePic(String profilePic) { this.profilePic = profilePic; }


	public Long getBatchCode() {
		return batchCode;
	}


	public void setBatchCode(Long batchCode) {
		this.batchCode = batchCode;
	}
}
package com.finalproject.internMgmtSystem.repository;

import com.finalproject.internMgmtSystem.model.User;
import com.finalproject.internMgmtSystem.repository.UserDao;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Repository;

import java.sql.Types;
import java.util.List;

@Repository
public class UserDaoImpl implements UserDao {

    @Autowired
    private JdbcTemplate jdbcTemplate;

    private RowMapper<User> mapper = (rs, rowNum) -> {
        User u = new User();
        u.setUserId(rs.getLong("user_id"));
        u.setUserName(rs.getString("user_name"));
        u.setEmail(rs.getString("email"));
        u.setPassword(rs.getString("password"));
        u.setDob(rs.getDate("dob"));
        u.setContactNo(rs.getString("contact_no"));
        u.setAddress(rs.getString("address"));
        u.setCollegeName(rs.getString("college_name"));
        u.setGrade(rs.getString("grade"));
        u.setMajor(rs.getString("major"));
        u.setTeam(rs.getString("team"));
        u.setBatchCode(rs.getLong("batchCode"));
        u.setStartDate(rs.getDate("start_date"));
        u.setEndDate(rs.getDate("end_date"));
        u.setGraduatingYear(rs.getInt("graduating_year"));
        u.setResume(rs.getString("resume"));
        u.setProfilePic(rs.getString("profile_pic"));
        u.setRole(rs.getString("role"));
        u.setCreatedAt(rs.getTimestamp("created_at"));
        return u;
    };

    @Override
    public User save(User user) {
        String sql = """
            INSERT INTO users (user_name, email, password, dob, contact_no, address, college_name, grade, major, 
            team,batchCode, start_date, end_date, graduating_year, resume, profile_pic, role)
            VALUES (?, ?, ?, ?, ?, ?, ?,?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        """;

        jdbcTemplate.update(sql,
                user.getUserName(),
                user.getEmail(),
                user.getPassword(),
                user.getDob(),
                user.getContactNo(),
                user.getAddress(),
                user.getCollegeName(),
                user.getGrade(),
                user.getMajor(),
                user.getTeam(),
                user.getBatchCode(),
                user.getStartDate(),
                user.getEndDate(),
                user.getGraduatingYear(),
                user.getResume(),
                user.getProfilePic(),
                user.getRole()
        );

        Long id = jdbcTemplate.queryForObject("SELECT LAST_INSERT_ID()", Long.class);
        user.setUserId(id);
        return user;
    }

    @Override
    public User findByEmail(String email) {
        List<User> list = jdbcTemplate.query(
                "SELECT * FROM users WHERE email = ?",
                mapper,
                email
        );
        return list.isEmpty() ? null : list.get(0);
    }

    @Override
    public User findById(Long id) {
        List<User> list = jdbcTemplate.query(
                "SELECT * FROM users WHERE user_id = ?",
                mapper,
                id
        );
        return list.isEmpty() ? null : list.get(0);
    }

    @Override
    public List<User> findAll() {
        return jdbcTemplate.query("SELECT * FROM users", mapper);
    }

    @Override
    public void update(User user) {
        String sql = """
            UPDATE users SET user_name=?, contact_no=?, address=?, college_name=?, grade=?, major=?, 
            team=?, start_date=?, end_date=?, graduating_year=?, resume=?, profile_pic=? WHERE user_id=?
        """;

        jdbcTemplate.update(sql,
                user.getUserName(),
                user.getContactNo(),
                user.getAddress(),
                user.getCollegeName(),
                user.getGrade(),
                user.getMajor(),
                user.getTeam(),
                user.getBatchCode(),
                user.getStartDate(),
                user.getEndDate(),
                user.getGraduatingYear(),
                user.getResume(),
                user.getProfilePic(),
                user.getUserId()
        );
    }

    @Override
    public void deleteById(Long id) {
        jdbcTemplate.update("DELETE FROM users WHERE user_id = ?", id);
    }
}
package com.finalproject.internMgmtSystem.service;

import com.finalproject.internMgmtSystem.dto.FeedbackDto;
import com.finalproject.internMgmtSystem.dto.RegisterUserDto;
import com.finalproject.internMgmtSystem.exception.ResourceNotFoundException;
import com.finalproject.internMgmtSystem.exception.UserAlreadyExistsException;
import com.finalproject.internMgmtSystem.model.*;
import com.finalproject.internMgmtSystem.repository.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class UserService {

    @Autowired
    private UserDao userDao;

    @Autowired
    private TaskDao taskDao;

    @Autowired
    private PerformanceDao performanceDao;

    @Autowired
    private StipendDao stipendDao;

    @Autowired
    private BatchDao batchDao;

    @Autowired
    private FeedbackDao feedbackDao;

    @Autowired
    private PasswordEncoder passwordEncoder;

    public User registerUser(RegisterUserDto dto) {

        // Check if email already exists
        User exists = userDao.findByEmail(dto.getEmail());
        if (exists != null) {
            throw new UserAlreadyExistsException("User email already exists: " + dto.getEmail());
        }

        User user = new User();
        user.setUserName(dto.getUserName());
        user.setEmail(dto.getEmail());
        user.setPassword(passwordEncoder.encode(dto.getPassword()));
        user.setDob(dto.getDob());
        user.setContactNo(dto.getContactNo());
        user.setAddress(dto.getAddress());
        user.setCollegeName(dto.getCollegeName());
        user.setGrade(dto.getGrade());
        user.setMajor(dto.getMajor());
        user.setTeam(dto.getTeam());
        user.setBatchCode(dto.getBatchCode());
        user.setStartDate(dto.getStartDate());
        user.setEndDate(dto.getEndDate());
        user.setGraduatingYear(dto.getGraduatingYear());
        user.setResume(dto.getResume());
        user.setProfilePic(dto.getProfilePic());
        user.setRole("USER");

        return userDao.save(user);
    }

    public List<Task> getTasks(Long userId) {
        List<Task> tasks = taskDao.findByUserId(userId);
        if (tasks.isEmpty()) {
            throw new ResourceNotFoundException("No tasks found for user ID: " + userId);
        }
        return tasks;
    }

    public List<Performance> getPerformance(Long userId) {
        List<Performance> list = performanceDao.findByUserId(userId);
        if (list.isEmpty()) {
            throw new ResourceNotFoundException("No performance records for user ID: " + userId);
        }
        return list;
    }

    public List<Stipend> getStipendHistory(Long userId) {
        List<Stipend> list = stipendDao.findByUserId(userId);
        if (list.isEmpty()) {
            throw new ResourceNotFoundException("No stipend records for user ID: " + userId);
        }
        return list;
    }

    public InternshipBatch getBatchDetails(Long batchCode) {
        InternshipBatch batch = batchDao.findById(batchCode);
        if (batch == null) {
            throw new ResourceNotFoundException("Batch not found with code: " + batchCode);
        }
        return batch;
    }

    public Feedback submitFeedback(FeedbackDto dto) {

        // You may also validate if batch or trainer exists

        Feedback f = new Feedback();
        f.setUserId(dto.getUserId());
        f.setUserName(dto.getUserName());
        f.setBatchCode(dto.getBatchCode());
        f.setTrainerName(dto.getTrainerName());
        f.setFeedback(dto.getFeedback());
        f.setRating(dto.getRating());

        return feedbackDao.save(f);
    }
}

{
    "error": "HV000030: No validator could be found for constraint 'jakarta.validation.constraints.NotBlank' validating type 'java.lang.Long'. Check configuration for 'batchCode'"
}
